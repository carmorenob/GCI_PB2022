$PBExportHeader$w_contratos.srw
forward
global type w_contratos from window
end type
type cb_can from picturebutton within w_contratos
end type
type cb_sig from picturebutton within w_contratos
end type
type cb_ant from picturebutton within w_contratos
end type
type dw_seguridad_lugar from datawindow within w_contratos
end type
type tab_1 from tab within w_contratos
end type
type tp_1 from userobject within tab_1
end type
type st_2 from statictext within tp_1
end type
type st_1 from statictext within tp_1
end type
type dw_1 from datawindow within tp_1
end type
type p_1 from picture within tp_1
end type
type cb_1 from commandbutton within tp_1
end type
type st_3 from statictext within tp_1
end type
type tp_1 from userobject within tab_1
st_2 st_2
st_1 st_1
dw_1 dw_1
p_1 p_1
cb_1 cb_1
st_3 st_3
end type
type tp_2 from userobject within tab_1
end type
type cb_copy from picturebutton within tp_2
end type
type cb_p2_ref from picturebutton within tp_2
end type
type cb_p2_gua from picturebutton within tp_2
end type
type cb_p2_bor from picturebutton within tp_2
end type
type cb_p2_adi from picturebutton within tp_2
end type
type cbx_1 from checkbox within tp_2
end type
type st_5 from statictext within tp_2
end type
type dw_p2_1 from datawindow within tp_2
end type
type dw_p2_2 from datawindow within tp_2
end type
type st_4 from statictext within tp_2
end type
type gb_1 from groupbox within tp_2
end type
type tp_2 from userobject within tab_1
cb_copy cb_copy
cb_p2_ref cb_p2_ref
cb_p2_gua cb_p2_gua
cb_p2_bor cb_p2_bor
cb_p2_adi cb_p2_adi
cbx_1 cbx_1
st_5 st_5
dw_p2_1 dw_p2_1
dw_p2_2 dw_p2_2
st_4 st_4
gb_1 gb_1
end type
type tp_3 from userobject within tab_1
end type
type cb_p3_req from picturebutton within tp_3
end type
type dw_p3_2 from datawindow within tp_3
end type
type st_7 from statictext within tp_3
end type
type dw_p3_1 from datawindow within tp_3
end type
type gb_2 from groupbox within tp_3
end type
type st_6 from statictext within tp_3
end type
type cb_7 from picturebutton within tp_3
end type
type cb_2 from picturebutton within tp_3
end type
type dw_p3_3 from datawindow within tp_3
end type
type cb_cop from picturebutton within tp_3
end type
type cb_cr from picturebutton within tp_3
end type
type tp_3 from userobject within tab_1
cb_p3_req cb_p3_req
dw_p3_2 dw_p3_2
st_7 st_7
dw_p3_1 dw_p3_1
gb_2 gb_2
st_6 st_6
cb_7 cb_7
cb_2 cb_2
dw_p3_3 dw_p3_3
cb_cop cb_cop
cb_cr cb_cr
end type
type tp_4 from userobject within tab_1
end type
type dw_p4_3 from datawindow within tp_4
end type
type st_10 from statictext within tp_4
end type
type ddlb_1 from dropdownlistbox within tp_4
end type
type dw_p4_2 from datawindow within tp_4
end type
type st_9 from statictext within tp_4
end type
type dw_p4_1 from datawindow within tp_4
end type
type st_8 from statictext within tp_4
end type
type gb_4 from groupbox within tp_4
end type
type cb_p5_cam from picturebutton within tp_4
end type
type cb_p4_adi from picturebutton within tp_4
end type
type cb_p4_bor from picturebutton within tp_4
end type
type cb_p4_ref from picturebutton within tp_4
end type
type cb_p4_gua from picturebutton within tp_4
end type
type gb_5 from groupbox within tp_4
end type
type cb_p4_get from picturebutton within tp_4
end type
type cb_p4_pri from picturebutton within tp_4
end type
type tp_4 from userobject within tab_1
dw_p4_3 dw_p4_3
st_10 st_10
ddlb_1 ddlb_1
dw_p4_2 dw_p4_2
st_9 st_9
dw_p4_1 dw_p4_1
st_8 st_8
gb_4 gb_4
cb_p5_cam cb_p5_cam
cb_p4_adi cb_p4_adi
cb_p4_bor cb_p4_bor
cb_p4_ref cb_p4_ref
cb_p4_gua cb_p4_gua
gb_5 gb_5
cb_p4_get cb_p4_get
cb_p4_pri cb_p4_pri
end type
type tp_5 from userobject within tab_1
end type
type cb_p5_taf from picturebutton within tp_5
end type
type cb_p5_cre from picturebutton within tp_5
end type
type cb_p5_cmo from picturebutton within tp_5
end type
type cb_p5_cop from picturebutton within tp_5
end type
type cb_3 from picturebutton within tp_5
end type
type dw_p5_4 from datawindow within tp_5
end type
type dw_p5_3 from datawindow within tp_5
end type
type dw_p5_2 from datawindow within tp_5
end type
type ddlb_2 from dropdownlistbox within tp_5
end type
type st_13 from statictext within tp_5
end type
type st_12 from statictext within tp_5
end type
type dw_p5_1 from datawindow within tp_5
end type
type st_11 from statictext within tp_5
end type
type gb_6 from groupbox within tp_5
end type
type gb_7 from groupbox within tp_5
end type
type gb_8 from groupbox within tp_5
end type
type tp_5 from userobject within tab_1
cb_p5_taf cb_p5_taf
cb_p5_cre cb_p5_cre
cb_p5_cmo cb_p5_cmo
cb_p5_cop cb_p5_cop
cb_3 cb_3
dw_p5_4 dw_p5_4
dw_p5_3 dw_p5_3
dw_p5_2 dw_p5_2
ddlb_2 ddlb_2
st_13 st_13
st_12 st_12
dw_p5_1 dw_p5_1
st_11 st_11
gb_6 gb_6
gb_7 gb_7
gb_8 gb_8
end type
type tab_1 from tab within w_contratos
tp_1 tp_1
tp_2 tp_2
tp_3 tp_3
tp_4 tp_4
tp_5 tp_5
end type
end forward

global type w_contratos from window
integer width = 5509
integer height = 2072
boolean titlebar = true
string title = "Asistente de contratación"
boolean controlmenu = true
boolean minbox = true
windowtype windowtype = popup!
windowstate windowstate = maximized!
long backcolor = 67108864
string icon = "ribon_contrato.ico"
boolean toolbarvisible = false
boolean clientedge = true
cb_can cb_can
cb_sig cb_sig
cb_ant cb_ant
dw_seguridad_lugar dw_seguridad_lugar
tab_1 tab_1
end type
global w_contratos w_contratos

type variables
string empres,i_contrat,anterior,tipoingreso,orden,i_mostrar='0'//1:activos 0:todos,
string lugar_seg, l_contrato,i_plan,i_tipo,l_ppto
datawindowchild contrato, ciudad,ciudad1,ciudad2,ciudad3
end variables

forward prototypes
public function boolean valida_prior ()
end prototypes

public function boolean valida_prior ();long j,prior1,prior2
string tipo1,tipo2
tab_1.tp_4.dw_p4_3.setsort("prioridad A")
tab_1.tp_4.dw_p4_3.sort()
for j= 2 to tab_1.tp_4.dw_p4_3.rowcount()
	prior1=tab_1.tp_4.dw_p4_3.getitemnumber(j -1,"prioridad")
	prior2=tab_1.tp_4.dw_p4_3.getitemnumber(j ,"prioridad")
	if prior1 = prior2 then 
		Messagebox("Error de Prioridades","La numeración de prioridades tiene números repetidos, revíselos e intente de nuevo")
		return false
	end if
	tipo1=tab_1.tp_4.dw_p4_3.getitemstring(j -1,"tipo")
	tipo2=tab_1.tp_4.dw_p4_3.getitemstring(j ,"tipo")
	choose case tipo2
		case "3" //alto c
			if tipo1= "2" or tipo1="1" then 
				messagebox("Error de Prioridades","Las prioridades no cumplen con las reglas básicas:~r~n~r~n1ro- Alto Costo~r~n2do- Grupo Etareo~r~n3ro- General~r~n~r~nRevise las prioridades o utilize el botón 'Prioridades'")
				return false
			end if
		case "2" //getareo
			if tipo1="1" then
				messagebox("Error de Prioridades","Las prioridades no cumplen con las reglas básicas:~r~n~r~n1ro- Alto Costo~r~n2do- Grupo Etareo~r~n3ro- General~r~n~r~nRevise las prioridades o utilize el botón 'Prioridades'")
				return false
			end if
	end choose
next
return true
end function

on w_contratos.create
this.cb_can=create cb_can
this.cb_sig=create cb_sig
this.cb_ant=create cb_ant
this.dw_seguridad_lugar=create dw_seguridad_lugar
this.tab_1=create tab_1
this.Control[]={this.cb_can,&
this.cb_sig,&
this.cb_ant,&
this.dw_seguridad_lugar,&
this.tab_1}
end on

on w_contratos.destroy
destroy(this.cb_can)
destroy(this.cb_sig)
destroy(this.cb_ant)
destroy(this.dw_seguridad_lugar)
destroy(this.tab_1)
end on

event closequery;if messagebox("Alerta","Esta seguro de abandonar el tutor de contratos",question!,yesno!,2)=2 then return 1
end event

event open;tab_1.tp_2.dw_p2_1.GetChild('cciudad', ciudad)
tab_1.tp_3.dw_p3_1.GetChild('cciudad', ciudad1)
tab_1.tp_4.dw_p4_1.GetChild('cciudad', ciudad2)
tab_1.tp_5.dw_p5_1.GetChild('cciudad', ciudad3)

SELECT cadena into :l_contrato
FROM parametros_gen
WHERE (((parametros_gen.codigo_para)=37));
if sqlca.sqlnrows=0 then
	messagebox('Atencíon','No hay parametro 37')
	return 
end if

SELECT cadena into :l_ppto
FROM parametros_gen
WHERE (((parametros_gen.codigo_para)=76));
if sqlca.sqlnrows=0 then
	messagebox('Atencíon','No hay parametro 76')
	return 
end if

if l_ppto='1' then
	tab_1.tp_2.dw_p2_2.Modify("cod_vigencia_recon.visible=1")
	tab_1.tp_2.dw_p2_2.Modify("cod_total_recon.visible=1")
else
	tab_1.tp_2.dw_p2_2.Modify("cod_vigencia_recon.visible=0")
	tab_1.tp_2.dw_p2_2.Modify("cod_total_recon.visible=0")
end if

if l_contrato='1' then
	if dw_seguridad_lugar.retrieve(clugar,usuario) = 0 then
		messageBox('Aviso','El usuario ' + usuario + ' no tiene ningun lugar a cargo')
		dw_seguridad_lugar.insertrow(0)
	else
		lugar_seg=dw_seguridad_lugar.getitemstring(1,'codlugar')
	End if
	dw_seguridad_lugar.InsertRow(0)
else 
	lugar_seg='%'
end if

ciudad.settransobject(sqlca)
ciudad1.settransobject(sqlca)
ciudad2.settransobject(sqlca)
ciudad3.settransobject(sqlca)
ciudad.retrieve()
ciudad1.retrieve()
ciudad2.retrieve()
ciudad3.retrieve()

end event

event resize;//gb_3.resize(newwidth -20, newheight -450)
//dw_detalle.resize(newwidth -50, newheight -900)
end event

type cb_can from picturebutton within w_contratos
string tag = "Cancelar"
integer x = 2254
integer y = 1812
integer width = 146
integer height = 128
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean originalsize = true
string picturename = "cancelar.GIF"
string disabledname = "d_cancelar.GIF"
end type

event clicked;close(parent)
end event

type cb_sig from picturebutton within w_contratos
string tag = "Siguiente"
integer x = 2094
integer y = 1812
integer width = 146
integer height = 128
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean default = true
boolean originalsize = true
string picturename = "adelante_1.gif"
string disabledname = "d_adelante_1.gif"
end type

event clicked;long donde
string depto
choose case tab_1.selectedtab
	case 1
		if tab_1.tp_1.dw_1.getitemstring(1,1)="" or  isnull(tab_1.tp_1.dw_1.getitemstring(1,1)) then 
			messagebox("Alerta","seleccione una empresa ~rpara continuar")
			return
		end if
		tab_1.tp_2.enabled=true
		tab_1.selectedtab=2
		tab_1.tp_1.enabled=false
		cb_ant.enabled=true
		tab_1.tp_2.dw_p2_1.retrieve(empres)
		//aca
		depto=tab_1.tp_2.dw_p2_1.getitemstring(1,"cdepto")
		if not isnull(depto) then 
			ciudad.setfilter("cdepto='"+depto+"'")
			ciudad.filter()
		end if
		tab_1.tp_2.dw_p2_1.retrieve(empres)
		
		tab_1.tp_2.dw_p2_2.retrieve(empres,lugar_seg)
		depto=tab_1.tp_2.dw_p2_1.getitemstring(1,"cdepto")
		if not isnull(depto) then 
			ciudad1.setfilter("cdepto='"+depto+"'")
			ciudad1.filter()
		end if
		if l_contrato='1' then
			tab_1.tp_2.dw_p2_2.Modify("clugar.visible=1") 
			tab_1.tp_2.dw_p2_2.Modify("clugar_t.visible=1") 
		else
			tab_1.tp_2.dw_p2_2.Modify("clugar.visible=0") 
			tab_1.tp_2.dw_p2_2.Modify("clugar_t.visible=0") 
		end if		
		if i_mostrar='1' then
			tab_1.tp_2.dw_p2_2.setfilter('estado="1"')
		else
			tab_1.tp_2.dw_p2_2.setfilter('')
		end if
		tab_1.tp_2.dw_p2_2.filter()
		tab_1.tp_2.cbx_1.triggerevent(clicked!)
		
	case 2
		if tab_1.tp_2.dw_p2_2.rowcount()=0 then return
		if tab_1.tp_2.dw_p2_2.update()=-1 then 
			rollback;
			return
		else 
			commit;
		end if
		tab_1.tp_3.enabled=true
		tab_1.selectedtab=3
		tab_1.tp_2.enabled=false
		tab_1.tp_3.dw_p3_1.retrieve(empres)
		
		depto=tab_1.tp_3.dw_p3_1.getitemstring(1,"cdepto")
		if not isnull(depto) then 
			ciudad2.setfilter("cdepto='"+depto+"'")
			ciudad2.filter()
		end if
		tab_1.tp_3.dw_p3_2.reset()
		tab_1.tp_3.dw_p3_2.retrieve(empres)
		if i_mostrar='1' then
			tab_1.tp_3.dw_p3_2.setfilter('estado="1"')
		else
			tab_1.tp_3.dw_p3_2.setfilter('')
		end if
		tab_1.tp_3.dw_p3_2.filter()
		donde=tab_1.tp_3.dw_p3_2.find("codcontrato='"+tab_1.tp_2.dw_p2_2.getitemstring(tab_1.tp_2.dw_p2_2.getrow(),'codcontrato')+"'",1,tab_1.tp_3.dw_p3_2.rowcount())
		if donde<> tab_1.tp_3.dw_p3_2.getrow() then tab_1.tp_3.dw_p3_2.scrolltorow(donde)
case 3
		if tab_1.tp_3.dw_p3_3.update()=-1 then 
			rollback;
			return
		else 
			commit;
		end if
		tab_1.tp_4.enabled=true
		tab_1.selectedtab=4
		tab_1.tp_3.enabled=false
		tab_1.tp_4.dw_p4_1.retrieve(empres)
		depto=tab_1.tp_4.dw_p4_1.getitemstring(1,"cdepto")
		if not isnull(depto) then 
			ciudad3.setfilter("cdepto='"+depto+"'")
			ciudad3.filter()
		end if
		tab_1.tp_4.dw_p4_2.reset()
		tab_1.tp_4.dw_p4_2.retrieve(empres)
		if i_mostrar='1' then
			tab_1.tp_4.dw_p4_2.setfilter('estado="1"')
		else
			tab_1.tp_4.dw_p4_2.setfilter('')
		end if
		tab_1.tp_4.dw_p4_2.filter()
		donde=tab_1.tp_4.dw_p4_2.find("codcontrato='"+tab_1.tp_3.dw_p3_2.getitemstring(tab_1.tp_3.dw_p3_2.getrow(),'codcontrato')+"'",1,tab_1.tp_4.dw_p4_2.rowcount())
		if donde<> tab_1.tp_4.dw_p4_2.getrow() then tab_1.tp_4.dw_p4_2.scrolltorow(donde)
	case 4
		if tab_1.tp_4.dw_p4_3.rowcount()=0 then
			messagebox("Error","Adicione planes para poder continuar")
			return
		end if
		if valida_prior()=false then return
		if tab_1.tp_4.dw_p4_3.update()=-1 then 
			rollback;
			return
		else 
			commit;
		end if
		tab_1.tp_5.enabled=true
		tab_1.selectedtab=5
		tab_1.tp_4.enabled=false
	//	text='&Terminar'
		tab_1.tp_5.dw_p5_1.retrieve(empres)
		tab_1.tp_5.dw_p5_2.reset()
		tab_1.tp_5.dw_p5_2.retrieve(empres)
		if i_mostrar='1' then
			tab_1.tp_5.dw_p5_2.setfilter('estado="1"')
		else
			tab_1.tp_5.dw_p5_2.setfilter('')
		end if
		tab_1.tp_5.dw_p5_2.filter()
		donde=tab_1.tp_5.dw_p5_2.find("codcontrato='"+tab_1.tp_4.dw_p4_2.getitemstring(tab_1.tp_4.dw_p4_2.getrow(),'codcontrato')+"'",1,tab_1.tp_5.dw_p5_2.rowcount())
		if donde<> tab_1.tp_5.dw_p5_2.getrow() then tab_1.tp_5.dw_p5_2.scrolltorow(donde)
	case 5
		if tab_1.tp_5.dw_p5_4.update()=-1 then 
			rollback;
			return
		else 
			commit;
			close(parent)
		end if
end choose
end event

type cb_ant from picturebutton within w_contratos
string tag = "Anterior"
integer x = 1925
integer y = 1812
integer width = 146
integer height = 128
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean originalsize = true
string picturename = "atras.gif"
string disabledname = "d_atras.gif"
end type

event clicked;long donde
choose case tab_1.selectedtab
	case 2
		tab_1.tp_2.enabled=false
		tab_1.selectedtab=1
		tab_1.tp_1.enabled=true
		enabled=false
	case 3
		tab_1.tp_2.enabled=true
		tab_1.selectedtab=2
		tab_1.tp_3.enabled=false
		donde=tab_1.tp_2.dw_p2_2.find("codcontrato='"+tab_1.tp_3.dw_p3_2.getitemstring(tab_1.tp_3.dw_p3_2.getrow(),'codcontrato')+"'",1,tab_1.tp_2.dw_p2_2.rowcount())
		if donde<> tab_1.tp_2.dw_p2_2.getrow() then tab_1.tp_2.dw_p2_2.scrolltorow(donde)
	case 4
		tab_1.tp_3.enabled=true
		tab_1.selectedtab=3
		tab_1.tp_4.enabled=false
		donde=tab_1.tp_3.dw_p3_2.find("codcontrato='"+tab_1.tp_4.dw_p4_2.getitemstring(tab_1.tp_4.dw_p4_2.getrow(),'codcontrato')+"'",1,tab_1.tp_3.dw_p3_2.rowcount())
		if donde<> tab_1.tp_3.dw_p3_2.getrow() then tab_1.tp_3.dw_p3_2.scrolltorow(donde)
	case 5
		tab_1.tp_4.enabled=true
		tab_1.selectedtab=4
		tab_1.tp_5.enabled=false
		donde=tab_1.tp_4.dw_p4_2.find("codcontrato='"+tab_1.tp_5.dw_p5_2.getitemstring(tab_1.tp_5.dw_p5_2.getrow(),'codcontrato')+"'",1,tab_1.tp_4.dw_p4_2.rowcount())
		if donde<> tab_1.tp_4.dw_p4_2.getrow() then tab_1.tp_4.dw_p4_2.scrolltorow(donde)
end choose
end event

type dw_seguridad_lugar from datawindow within w_contratos
boolean visible = false
integer x = 2697
integer y = 1836
integer width = 667
integer height = 84
integer taborder = 50
string title = "none"
string dataobject = "dw_lugares_usuario"
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;settransobject(sqlca)
end event

type tab_1 from tab within w_contratos
integer x = 32
integer y = 36
integer width = 5394
integer height = 1744
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 67108864
boolean focusonbuttondown = true
boolean powertips = true
alignment alignment = center!
integer selectedtab = 1
tp_1 tp_1
tp_2 tp_2
tp_3 tp_3
tp_4 tp_4
tp_5 tp_5
end type

on tab_1.create
this.tp_1=create tp_1
this.tp_2=create tp_2
this.tp_3=create tp_3
this.tp_4=create tp_4
this.tp_5=create tp_5
this.Control[]={this.tp_1,&
this.tp_2,&
this.tp_3,&
this.tp_4,&
this.tp_5}
end on

on tab_1.destroy
destroy(this.tp_1)
destroy(this.tp_2)
destroy(this.tp_3)
destroy(this.tp_4)
destroy(this.tp_5)
end on

type tp_1 from userobject within tab_1
event create ( )
event destroy ( )
integer x = 18
integer y = 112
integer width = 5358
integer height = 1616
long backcolor = 67108864
string text = " Escoger Empresa"
long tabtextcolor = 33554432
string picturename = "elegir.ico"
long picturemaskcolor = 536870912
string powertiptext = "Selección de Empresa"
st_2 st_2
st_1 st_1
dw_1 dw_1
p_1 p_1
cb_1 cb_1
st_3 st_3
end type

on tp_1.create
this.st_2=create st_2
this.st_1=create st_1
this.dw_1=create dw_1
this.p_1=create p_1
this.cb_1=create cb_1
this.st_3=create st_3
this.Control[]={this.st_2,&
this.st_1,&
this.dw_1,&
this.p_1,&
this.cb_1,&
this.st_3}
end on

on tp_1.destroy
destroy(this.st_2)
destroy(this.st_1)
destroy(this.dw_1)
destroy(this.p_1)
destroy(this.cb_1)
destroy(this.st_3)
end on

type st_2 from statictext within tp_1
integer x = 1239
integer y = 284
integer width = 2373
integer height = 292
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 8388608
long backcolor = 16777215
string text = "Las empresas pueden ser cualquier tipo de Aseguradora de Salud, (EPS, ARS, SOAT,etc.) un ente territorial o cualquier persona juridica con la cual pactamos prestar servicios de salud a un grupo de afiliados, con cargo a la empresa. "
boolean focusrectangle = false
end type

type st_1 from statictext within tp_1
integer x = 1248
integer y = 704
integer width = 832
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Seleccione una &Empresa"
boolean focusrectangle = false
end type

type dw_1 from datawindow within tp_1
integer x = 1234
integer y = 764
integer width = 2098
integer height = 100
integer taborder = 10
string title = "none"
string dataobject = "dw_combo_empresa"
boolean border = false
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event itemchanged;accepttext()
empres=data

end event

event constructor;settransobject(sqlca)
insertrow(1)
end event

type p_1 from picture within tp_1
integer x = 87
integer y = 324
integer width = 942
integer height = 840
string picturename = "Contrato.jpg"
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

type cb_1 from commandbutton within tp_1
integer x = 3342
integer y = 764
integer width = 82
integer height = 72
integer taborder = 20
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "..."
end type

event clicked;open(w_busqueda_empresa)
end event

type st_3 from statictext within tp_1
integer x = 1093
integer y = 152
integer width = 3799
integer height = 456
integer textsize = -14
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 8388608
long backcolor = 16777215
string text = "        ASISTENTE ELABORACIÓN DE CONTRATOS"
alignment alignment = center!
boolean border = true
boolean focusrectangle = false
end type

type tp_2 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 5358
integer height = 1616
boolean enabled = false
long backcolor = 67108864
string text = " Registrar Contratos"
long tabtextcolor = 33554432
string picturename = "contratos.ico"
long picturemaskcolor = 536870912
string powertiptext = "Registro de Contratos"
cb_copy cb_copy
cb_p2_ref cb_p2_ref
cb_p2_gua cb_p2_gua
cb_p2_bor cb_p2_bor
cb_p2_adi cb_p2_adi
cbx_1 cbx_1
st_5 st_5
dw_p2_1 dw_p2_1
dw_p2_2 dw_p2_2
st_4 st_4
gb_1 gb_1
end type

on tp_2.create
this.cb_copy=create cb_copy
this.cb_p2_ref=create cb_p2_ref
this.cb_p2_gua=create cb_p2_gua
this.cb_p2_bor=create cb_p2_bor
this.cb_p2_adi=create cb_p2_adi
this.cbx_1=create cbx_1
this.st_5=create st_5
this.dw_p2_1=create dw_p2_1
this.dw_p2_2=create dw_p2_2
this.st_4=create st_4
this.gb_1=create gb_1
this.Control[]={this.cb_copy,&
this.cb_p2_ref,&
this.cb_p2_gua,&
this.cb_p2_bor,&
this.cb_p2_adi,&
this.cbx_1,&
this.st_5,&
this.dw_p2_1,&
this.dw_p2_2,&
this.st_4,&
this.gb_1}
end on

on tp_2.destroy
destroy(this.cb_copy)
destroy(this.cb_p2_ref)
destroy(this.cb_p2_gua)
destroy(this.cb_p2_bor)
destroy(this.cb_p2_adi)
destroy(this.cbx_1)
destroy(this.st_5)
destroy(this.dw_p2_1)
destroy(this.dw_p2_2)
destroy(this.st_4)
destroy(this.gb_1)
end on

type cb_copy from picturebutton within tp_2
string tag = "Copiar"
integer x = 759
integer y = 1432
integer width = 146
integer height = 128
integer taborder = 42
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean originalsize = true
string picturename = "copiar.gif"
string disabledname = "d_copiar.gif"
end type

event clicked;if dw_p2_2.rowcount()=0 then return
openwithparm(w_copia_cont,dw_p2_2)
if message.stringparm='si' then cb_p2_ref.triggerevent(clicked!)
end event

type cb_p2_ref from picturebutton within tp_2
string tag = "Refrescar"
integer x = 585
integer y = 1432
integer width = 146
integer height = 128
integer taborder = 32
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean originalsize = true
string picturename = "refrescar.gif"
string disabledname = "d_refrescar.gif"
end type

event clicked;dw_p2_2.retrieve(empres,lugar_seg)
end event

type cb_p2_gua from picturebutton within tp_2
string tag = "Guardar"
integer x = 411
integer y = 1432
integer width = 146
integer height = 128
integer taborder = 22
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean originalsize = true
string picturename = "guardar2.gif"
string disabledname = "d_guardar2.gif"
end type

event clicked;if dw_p2_2.update()=-1 then 
	rollback;
else 
	commit;
end if

end event

type cb_p2_bor from picturebutton within tp_2
string tag = "Borrar"
integer x = 238
integer y = 1432
integer width = 146
integer height = 128
integer taborder = 12
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean originalsize = true
string picturename = "borrar_fila.gif"
string disabledname = "d_borrar_fila.gif"
end type

event clicked;if l_contrato='1' then
	if lugar_seg=dw_p2_2.getitemstring(dw_p2_2.getrow(),'clugar') then
		dw_p2_2.deleterow(0)
	else
		messagebox("Atención","No puede eliminar el contrato por no tener asociado el mismo lugar ")
	end  if
else
	dw_p2_2.deleterow(0)
end if
end event

type cb_p2_adi from picturebutton within tp_2
string tag = "Adicionar"
integer x = 64
integer y = 1432
integer width = 146
integer height = 128
integer taborder = 12
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean originalsize = true
string picturename = "insertar.GIF"
string disabledname = "d_insertar.GIF"
end type

event clicked;long fila,contrat
string l_con

if l_contrato='1' then 
	If dw_seguridad_lugar.rowcount()>0 then 
		fila=dw_p2_2.insertrow(0)
		dw_p2_2.SetColumn('clugar') 
		dw_p2_2.SetFocus()
		dw_p2_2.scrolltorow(fila)
		dw_p2_2.setitem(fila,'codemp',empres)
		if dw_p2_2.rowcount()=1 then 
			contrat=0
		else
			contrat=dw_p2_2.getitemnumber(1,"maximo")
		end if 
		contrat++
		dw_p2_2.setitem(fila,"codcontrato",string(contrat))
		dw_p2_2.setitem(fila,"clugar",lugar_seg)
		dw_p2_2.setitem(fila,"lugares",clugar)
	else
		messagebox("Atención","No hay Lugar definido para el usuario")
	end If
Else
	fila=dw_p2_2.insertrow(0)
	dw_p2_2.scrolltorow(fila)
	dw_p2_2.setitem(fila,'codemp',empres)
	if dw_p2_2.rowcount()=1 then 
		contrat=0
	else
		contrat=dw_p2_2.getitemnumber(1,"maximo")
	end if 
	contrat++
	dw_p2_2.setitem(fila,"codcontrato",string(contrat))
	setnull(l_con)
	dw_p2_2.setitem(fila,"clugar",l_con)
	dw_p2_2.setitem(fila,"lugares",'%')
	dw_p2_2.SetColumn('descontrato') 
	dw_p2_2.scrolltorow(fila)
	dw_p2_2.SetFocus()
End If

end event

type cbx_1 from checkbox within tp_2
integer x = 46
integer y = 1372
integer width = 603
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Mostrar solo los Activos"
boolean checked = true
end type

event clicked;if checked then
	i_mostrar='1'//activos
	dw_p2_2.setfilter('estado="1"')
else
	i_mostrar='0'
	dw_p2_2.setfilter('')
end if
dw_p2_2.filter()


end event

type st_5 from statictext within tp_2
integer x = 1915
integer y = 1412
integer width = 3323
integer height = 128
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 8388608
long backcolor = 134217752
string text = "Con una empresa se puede celebrar uno o mas contratos. Cargue la información básica de cada uno de ellos"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type dw_p2_1 from datawindow within tp_2
integer x = 5
integer y = 88
integer width = 4069
integer height = 376
string title = "none"
string dataobject = "dw_empresa"
boolean border = false
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event itemchanged;this.accepttext()
empres=getitemstring(row,'cdepto')
this.retrieve(data)
ciudad.setfilter("cdepto='"+empres+"'")
ciudad.filter()
this.setitem(1,"cciudad","")
dw_p2_2.retrieve(data,lugar_seg)
tab_1.tp_1.dw_1.setitem(1,1,empres)
end event

event constructor;this.settransobject(sqlca)
this.getchild("cciudad",ciudad)
ciudad.settransobject(sqlca)
ciudad.retrieve()
this.settransobject(sqlca)
end event

type dw_p2_2 from datawindow within tp_2
event p_itemchanged ( )
event keyup pbm_dwnkey
integer x = 41
integer y = 600
integer width = 5216
integer height = 748
integer taborder = 50
string dataobject = "dw_contrato"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
borderstyle borderstyle = stylelowered!
end type

event p_itemchanged();accepttext()
setitem(getrow(),'clave_db',f_encripta(getitemstring(getrow(),'clave_db')))

end event

event keyup;string codemp
choose case getcolumnName()
	case 'codtotal_pxc'
		codemp=getitemstring(getrow(),'cod_empre_pxc')
	case 'codtotal_pxp'
		codemp=getitemstring(getrow(),'cod_empre_pxp')
	case 'codtotal_pxc_pendi'
		codemp=getitemstring(getrow(),'cod_empre_pxc_pendi')
	case 'codtotal_pxp_abono'
		codemp=getitemstring(getrow(),'cod_empre_pxp_abono')
	case else 
		return
end choose
f_busca_cuenta(key,codemp,this)



end event

event itemchanged;if getcolumnname()='clave_db' then
	post event p_itemchanged()
end if
end event

event constructor;settransobject(sqlca)
end event

event itemfocuschanged;string codemp
choose case getcolumnName()
	case 'codtotal_pxc'
		codemp=getitemstring(getrow(),'cod_empre_pxc')
	case 'codtotal_pxp'
		codemp=getitemstring(getrow(),'cod_empre_pxp')
	case 'codtotal_pxc_pendi'
		codemp=getitemstring(getrow(),'cod_empre_pxc_pendi')
	case 'codtotal_pxp_abono'
		codemp=getitemstring(getrow(),'cod_empre_pxp_abono')
end choose
f_semovio(this,codemp,{'codtotal_pxc','codtotal_pxp','codtotal_pxc_pendi','codtotal_pxp_abono'})
end event

event getfocus;string codemp
choose case getcolumnName()
	case 'codtotal_pxc'
		codemp=getitemstring(getrow(),'cod_empre_pxc')
	case 'codtotal_pxp'
		codemp=getitemstring(getrow(),'cod_empre_pxp')
	case 'codtotal_pxc_pendi'
		codemp=getitemstring(getrow(),'cod_empre_pxc_pendi')
	case 'codtotal_pxp_abono'
		codemp=getitemstring(getrow(),'cod_empre_pxp_abono')
end choose
f_semovio(this,codemp,{'codtotal_pxc','codtotal_pxp','codtotal_pxc_pendi','codtotal_pxp_abono'})
end event

event doubleclicked;if dw_p2_2.getitemstring(dw_p2_2.getrow(),'ctcontra')='2' then
	i_contrat=dw_p2_2.getitemstring(dw_p2_2.getrow(),'codcontrato')
	open(w_contrato_capitaufcc)
end if	
end event

type st_4 from statictext within tp_2
integer x = 96
integer width = 1070
integer height = 100
integer textsize = -14
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 8388608
long backcolor = 67108864
string text = "Registro de Contratos"
boolean focusrectangle = false
end type

type gb_1 from groupbox within tp_2
integer x = 14
integer y = 516
integer width = 5294
integer height = 1080
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "DATOS DEL CONTRATO"
end type

type tp_3 from userobject within tab_1
event create ( )
event destroy ( )
integer x = 18
integer y = 112
integer width = 5358
integer height = 1616
boolean enabled = false
long backcolor = 67108864
string text = "Configurar Contratos"
long tabtextcolor = 33554432
string picturename = "configura.ico"
long picturemaskcolor = 536870912
string powertiptext = "Configuración de Contratos"
cb_p3_req cb_p3_req
dw_p3_2 dw_p3_2
st_7 st_7
dw_p3_1 dw_p3_1
gb_2 gb_2
st_6 st_6
cb_7 cb_7
cb_2 cb_2
dw_p3_3 dw_p3_3
cb_cop cb_cop
cb_cr cb_cr
end type

on tp_3.create
this.cb_p3_req=create cb_p3_req
this.dw_p3_2=create dw_p3_2
this.st_7=create st_7
this.dw_p3_1=create dw_p3_1
this.gb_2=create gb_2
this.st_6=create st_6
this.cb_7=create cb_7
this.cb_2=create cb_2
this.dw_p3_3=create dw_p3_3
this.cb_cop=create cb_cop
this.cb_cr=create cb_cr
this.Control[]={this.cb_p3_req,&
this.dw_p3_2,&
this.st_7,&
this.dw_p3_1,&
this.gb_2,&
this.st_6,&
this.cb_7,&
this.cb_2,&
this.dw_p3_3,&
this.cb_cop,&
this.cb_cr}
end on

on tp_3.destroy
destroy(this.cb_p3_req)
destroy(this.dw_p3_2)
destroy(this.st_7)
destroy(this.dw_p3_1)
destroy(this.gb_2)
destroy(this.st_6)
destroy(this.cb_7)
destroy(this.cb_2)
destroy(this.dw_p3_3)
destroy(this.cb_cop)
destroy(this.cb_cr)
end on

type cb_p3_req from picturebutton within tp_3
string tag = "Requisitos"
integer x = 1833
integer y = 776
integer width = 146
integer height = 128
integer taborder = 12
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean originalsize = true
string picturename = "requisitos.gif"
end type

event clicked;if dw_p3_2.rowcount()=0 then return
Open(w_contr_requi)
end event

type dw_p3_2 from datawindow within tp_3
integer x = 32
integer y = 784
integer width = 1774
integer height = 768
integer taborder = 1
string title = "none"
string dataobject = "dw_lista_contratos"
boolean hscrollbar = true
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event rowfocuschanged;long fila
fila=getrow()
selectrow(0,false)
selectrow(fila,true)
if fila<1 then return
if l_contrato='1' then
	if lugar_seg=dw_p3_2.getitemstring(fila,'clugar') then
		dw_p3_3.enabled=true
		dw_p3_3.reset()
		i_contrat=getitemstring(fila,'codcontrato')
		dw_p3_3.retrieve(empres,i_contrat)
	else
		dw_p3_3.enabled=false
	end if
else
	dw_p3_3.enabled=true
	dw_p3_3.reset()
	i_contrat=getitemstring(fila,'codcontrato')
	dw_p3_3.retrieve(empres,i_contrat)
end If
end event

event constructor;this.settransobject(sqlca)
end event

type st_7 from statictext within tp_3
integer x = 18
integer y = 476
integer width = 2007
integer height = 236
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 8388608
long backcolor = 134217752
string text = "Un contrato puede tener varias restricciones o ampliaciones que difieren a las reglas de juego generales, en aspectos que dependen del grupo etareo, tipo de afiliacion o patologias de alto costo."
alignment alignment = center!
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type dw_p3_1 from datawindow within tp_3
integer x = 37
integer y = 12
integer width = 4050
integer height = 376
string title = "none"
string dataobject = "dw_empresa"
boolean border = false
borderstyle borderstyle = stylelowered!
end type

event itemchanged;this.accepttext()
empres=data
dw_p3_1.retrieve(empres)
dw_p3_2.retrieve(empres)
dw_p3_2.triggerevent(rowfocuschanged!)

end event

event constructor;this.settransobject(sqlca)

end event

type gb_2 from groupbox within tp_3
integer x = 9
integer y = 716
integer width = 2021
integer height = 880
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Contratos"
end type

type st_6 from statictext within tp_3
integer x = 2117
integer y = 412
integer width = 1193
integer height = 88
boolean bringtotop = true
integer textsize = -14
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 8388608
long backcolor = 80269524
string text = "Configuración de contratos"
boolean focusrectangle = false
end type

type cb_7 from picturebutton within tp_3
string tag = "Borrar"
integer x = 4631
integer y = 600
integer width = 146
integer height = 128
integer taborder = 14
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean originalsize = true
string picturename = "borrar_fila.gif"
end type

event clicked;string nulo
setnull(nulo)
dw_p3_3.setitem(1,"segrespon",nulo)
dw_p3_3.setitem(1,"contsegrespon",nulo)
end event

type cb_2 from picturebutton within tp_3
string tag = "Guardar"
integer x = 4686
integer y = 1372
integer width = 146
integer height = 128
integer taborder = 13
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean originalsize = true
string picturename = "guardar2.gif"
string disabledname = "d_guardar2.gif"
end type

event clicked;if dw_p3_3.update()=-1 then 
	rollback;
else 
	commit;
end if
end event

type dw_p3_3 from datawindow within tp_3
integer x = 2071
integer y = 552
integer width = 2761
integer height = 992
integer taborder = 3
string title = "none"
string dataobject = "dw_confi_contrato"
boolean border = false
end type

event itemchanged;this.accepttext()
long cuantos,nulo
setnull(nulo)
string cont,l_emp

cont=dw_p3_2.getitemstring(dw_p3_2.getrow(),'codcontrato')
choose case this.getcolumnname()
	case "segrespon"
		l_emp=dw_p3_1.getitemstring(dw_p3_1.getrow(),'codemp')
		if l_emp<>this.gettext() then 
			contrato.setfilter("codemp='"+this.gettext()+"'" )
			//+" and codcontrato<>'"+i_contrat+"'")
		else
			contrato.setfilter("codemp='"+l_emp+"'"+" and codcontrato<>'"+i_contrat+"'")
		end if
		contrato.filter()
		this.setitem(1,"contsegrespon","")
	case "topecopago"
		if data="0" then 
			cb_cop.enabled=false
			cb_cop.visible=false
		else
			this.setitem(1,"topecoutarecu","0")
			cb_cr.enabled=false
			cb_cop.enabled=true
			cb_cr.visible=false
			cb_cop.visible=true
		end if
	case "topecoutarecu"
		if data="0" then 
			cb_cr.enabled=false
			cb_cr.visible=false
		else
			this.setitem(1,"topecopago","0")
			cb_cop.enabled=false
			cb_cr.enabled=true
			cb_cop.visible=false
			cb_cr.visible=true
		end if
	case "getareo"
		if data='0' then
			select count(cplan) into :cuantos from contratodet where cemp=:empres and ccontrato=:cont and tipo='2';
			if cuantos>0 then
				messagebox("Atención","Este contrato tiene planes que cumplen la regla de Grupo Etareo")
				return 1
			end if
		end if
	case "altocosto"
		if data='1' then
			select count(cplan) into :cuantos from contratodet where cemp=:empres and ccontrato=:cont and tipo='3';
			if cuantos>0 then
				messagebox("Atención","Este contrato tiene planes que cumplen la regla de Alto Costo")
				return 1
			end if
		end if
	case "catastrofe"
		if data="1" then
			this.setitem(1,"soat","0")
			this.setitem(1,'vtopefijo',nulo)
		end if
	case 'soat'
		if data="1" then this.setitem(1,"catastrofe","0")
end choose
end event

event retrieveend;if not isnull(getitemstring(1,"segrespon")) then
	setitem(1,'contsegrespon',getitemstring(1,'contsegrespon'))
	contrato.setfilter("codemp='"+getitemstring(1,"segrespon")+"'")
	contrato.filter()
end if
if getitemstring(1,"topecopago")="0" or isnull(getitemstring(1,"topecopago")) then 
	cb_cop.enabled=false
else
	cb_cop.enabled=true
end if
if getitemstring(1,"topecoutarecu")="0" or isnull(getitemstring(1,"topecoutarecu")) then 
	cb_cr.enabled=false
else
	cb_cr.enabled=true
end if
if getitemstring(1,"getareo")="0" or isnull(getitemstring(1,"getareo"))then 
	//cb_5.enabled=false
else
	//cb_5.enabled=true
end if




end event

event constructor;this.settransobject(sqlca)
this.geTchild("contsegrespon",contrato)
contrato.settransobject(SQLCA)
contrato.retrieve()
contrato.setfilter("codemp=''")
contrato.filter()
end event

type cb_cop from picturebutton within tp_3
string tag = "Copago"
boolean visible = false
integer x = 2711
integer y = 988
integer width = 146
integer height = 128
integer taborder = 16
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean enabled = false
boolean originalsize = true
string picturename = "copago.gif"
string disabledname = "d_copago.gif"
end type

event clicked;Open(w_topes_estrato)
end event

type cb_cr from picturebutton within tp_3
string tag = "Cuota Recuperación"
boolean visible = false
integer x = 2706
integer y = 988
integer width = 146
integer height = 128
integer taborder = 42
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean enabled = false
string picturename = "cuotar.gif"
string disabledname = "d_copago.gif"
end type

event clicked;Open(w_topes_estrato)
end event

type tp_4 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 5358
integer height = 1616
boolean enabled = false
long backcolor = 67108864
string text = "Asignar Planes"
long tabtextcolor = 33554432
string picturename = "configura.ico"
long picturemaskcolor = 536870912
string powertiptext = "Asignación de planes de servicios"
dw_p4_3 dw_p4_3
st_10 st_10
ddlb_1 ddlb_1
dw_p4_2 dw_p4_2
st_9 st_9
dw_p4_1 dw_p4_1
st_8 st_8
gb_4 gb_4
cb_p5_cam cb_p5_cam
cb_p4_adi cb_p4_adi
cb_p4_bor cb_p4_bor
cb_p4_ref cb_p4_ref
cb_p4_gua cb_p4_gua
gb_5 gb_5
cb_p4_get cb_p4_get
cb_p4_pri cb_p4_pri
end type

on tp_4.create
this.dw_p4_3=create dw_p4_3
this.st_10=create st_10
this.ddlb_1=create ddlb_1
this.dw_p4_2=create dw_p4_2
this.st_9=create st_9
this.dw_p4_1=create dw_p4_1
this.st_8=create st_8
this.gb_4=create gb_4
this.cb_p5_cam=create cb_p5_cam
this.cb_p4_adi=create cb_p4_adi
this.cb_p4_bor=create cb_p4_bor
this.cb_p4_ref=create cb_p4_ref
this.cb_p4_gua=create cb_p4_gua
this.gb_5=create gb_5
this.cb_p4_get=create cb_p4_get
this.cb_p4_pri=create cb_p4_pri
this.Control[]={this.dw_p4_3,&
this.st_10,&
this.ddlb_1,&
this.dw_p4_2,&
this.st_9,&
this.dw_p4_1,&
this.st_8,&
this.gb_4,&
this.cb_p5_cam,&
this.cb_p4_adi,&
this.cb_p4_bor,&
this.cb_p4_ref,&
this.cb_p4_gua,&
this.gb_5,&
this.cb_p4_get,&
this.cb_p4_pri}
end on

on tp_4.destroy
destroy(this.dw_p4_3)
destroy(this.st_10)
destroy(this.ddlb_1)
destroy(this.dw_p4_2)
destroy(this.st_9)
destroy(this.dw_p4_1)
destroy(this.st_8)
destroy(this.gb_4)
destroy(this.cb_p5_cam)
destroy(this.cb_p4_adi)
destroy(this.cb_p4_bor)
destroy(this.cb_p4_ref)
destroy(this.cb_p4_gua)
destroy(this.gb_5)
destroy(this.cb_p4_get)
destroy(this.cb_p4_pri)
end on

type dw_p4_3 from datawindow within tp_4
integer x = 1947
integer y = 828
integer width = 3291
integer height = 600
integer taborder = 3
string title = "none"
string dataobject = "dw_contrato_planes"
boolean hscrollbar = true
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event clicked;if dwo.type = "text" then 
	string cual,ojo,ss
	cual=dwo.name
	cual=mid(cual,1,len(cual) - 2)
	if anterior=cual then
		if orden="A" then
			orden="D"
		else
			orden="A"
		end if
	else
		orden="A"
	end if
	this.setsort(cual+" "+orden)
	this.sort()
	anterior=cual
end if
end event

event itemchanged;if dwo.name="tipo" then
	choose case data
		case "1"
			cb_p4_get.enabled=false
			cb_p5_cam.enabled=false
		case "2"
			if dw_p4_2.getitemstring(dw_p4_2.getrow(),"getareo")="0" then 
				//this.setitem(row,"tipo","1")
				return 1
			end if
			cb_p4_get.enabled=true
		case "3"
			cb_p4_get.enabled=false
			if dw_p4_2.getitemstring(dw_p4_2.getrow(),"altocosto")="0" then 
				//this.setitem(row,"tipo","1")
				return 1
			end if
		case "4"
			cb_p5_cam.enabled=true
			if dw_p4_2.getitemstring(dw_p4_2.getrow(),"estancia")="0" then 
				//this.setitem(row,"tipo","1")
				return 1
			end if
	end choose
end if
this.accepttext()
end event

event retrieveend;this.triggerevent(rowfocuschanged!)

end event

event rowfocuschanged;if this.getrow()<1 then return
this.selectrow(0,false)
this.selectrow(this.getrow(),true)
if this.getitemstring(this.getrow(),"tipo")='2' then 
	cb_p4_get.enabled=true
else
	cb_p4_get.enabled=false
end if
end event

event constructor;this.settransobject(sqlca)
end event

type st_10 from statictext within tp_4
integer x = 1966
integer y = 732
integer width = 361
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Tipo de Ingreso:"
boolean focusrectangle = false
end type

type ddlb_1 from dropdownlistbox within tp_4
integer x = 2350
integer y = 712
integer width = 1038
integer height = 400
integer taborder = 2
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "none"
boolean sorted = false
boolean vscrollbar = true
string item[] = {"CONSULTA EXTERNA","URGENCIAS","HOSPITALIZACIÓN","AMBULATORIO","UCI"}
borderstyle borderstyle = stylelowered!
end type

event constructor;this.text="CONSULTA EXTERNA"
end event

event selectionchanged;choose case this.text
	case "CONSULTA EXTERNA"
		tipoingreso='1'
	case 'URGENCIAS'
		tipoingreso='2'
	case 'HOSPITALIZACIÓN'
		tipoingreso='3'
	case 'AMBULATORIO'
		tipoingreso='4'
	case 'UCI'
		tipoingreso='7'	
end choose
dw_p4_3.setfilter("codtingre='"+tipoingreso+"'")
dw_p4_3.filter()

end event

type dw_p4_2 from datawindow within tp_4
integer x = 59
integer y = 712
integer width = 1774
integer height = 864
integer taborder = 1
string title = "none"
string dataobject = "dw_lista_contratos"
boolean hscrollbar = true
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event rowfocuschanged;long fila
fila = getrow()
selectrow(0,false)
selectrow(fila,true)
if fila<=0 then return
if l_contrato='1' then
	if lugar_seg=dw_p4_2.getitemstring(fila,'clugar') then
		dw_p4_3.enabled=true
		i_contrat=getitemstring(getrow(),2)
		dw_p4_3.retrieve(empres,i_contrat)
		ddlb_1.triggerevent(selectionchanged!)
	else 
		dw_p4_3.enabled=false
	end if
else
	dw_p4_3.enabled=true
	i_contrat=getitemstring(getrow(),2)
	dw_p4_3.retrieve(empres,i_contrat)
	ddlb_1.triggerevent(selectionchanged!)
end If
end event

event constructor;this.settransobject(sqlca)
end event

type st_9 from statictext within tp_4
integer x = 87
integer y = 488
integer width = 5207
integer height = 140
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 8388608
long backcolor = 134217752
string text = "Cada contrato debe tener por lo menos un plan de servicios asociado para cada uno de los tipos de ingresos, a dicho plan se le define un manual tarifario y un porcentaje de cobro para efectos de la liquidación de cuentas"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type dw_p4_1 from datawindow within tp_4
integer x = 23
integer y = 88
integer width = 4224
integer height = 384
string title = "none"
string dataobject = "dw_empresa"
boolean border = false
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event itemchanged;this.accepttext()
empres=data
this.retrieve(empres)
dw_p4_2.retrieve(empres)
dw_p4_2.triggerevent(rowfocuschanged!)

end event

event constructor;this.settransobject(sqlca)
end event

type st_8 from statictext within tp_4
integer x = 27
integer y = 4
integer width = 1481
integer height = 100
integer textsize = -14
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 8388608
long backcolor = 80269524
string text = "Asignación de planes de servicios"
boolean focusrectangle = false
end type

type gb_4 from groupbox within tp_4
integer x = 27
integer y = 640
integer width = 1847
integer height = 956
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 80269524
string text = "Contratos"
end type

type cb_p5_cam from picturebutton within tp_4
boolean visible = false
integer x = 1408
integer y = 1448
integer width = 146
integer height = 128
integer taborder = 78
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean enabled = false
boolean originalsize = true
string picturename = "dif_cama.gif"
string disabledname = "d_difcama.gif"
alignment htextalign = left!
end type

event clicked;if dw_p4_3.rowcount()=0 then return
LONG fila
fila=dw_p4_3.getrow()
if dw_p4_3.update()=-1 then 
	rollback;
else 
	dw_p4_3.scrolltorow(fila)
	commit;
	open(w_contr_estancia)
end if
end event

type cb_p4_adi from picturebutton within tp_4
string tag = "Adicionar"
integer x = 3241
integer y = 1448
integer width = 146
integer height = 128
integer taborder = 18
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean originalsize = true
string picturename = "insertar.GIF"
string disabledname = "d_insertar.GIF"
end type

event clicked;long fila
dw_p4_2.setfocus()
fila=dw_p4_3.insertrow(0)
dw_p4_3.scrolltorow(fila)
dw_p4_3.setitem(fila,'cemp',empres)
dw_p4_3.setitem(fila,'ccontrato',i_contrat)
dw_p4_3.setitem(fila,'codtingre',tipoingreso)
end event

type cb_p4_bor from picturebutton within tp_4
string tag = "Borrar"
integer x = 3406
integer y = 1448
integer width = 146
integer height = 128
integer taborder = 28
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean originalsize = true
string picturename = "borrar_fila.gif"
string disabledname = "d_borrar_fila.gif"
end type

event clicked;dw_p4_3.deleterow(dw_p4_3.getrow())
end event

type cb_p4_ref from picturebutton within tp_4
string tag = "Refrescar"
integer x = 3575
integer y = 1448
integer width = 146
integer height = 128
integer taborder = 38
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean originalsize = true
string picturename = "refrescar.gif"
string disabledname = "d_refrescar.gif"
end type

event clicked;dw_p4_3.retrieve(empres,i_contrat)

end event

type cb_p4_gua from picturebutton within tp_4
string tag = "Guardar"
integer x = 3744
integer y = 1448
integer width = 146
integer height = 128
integer taborder = 48
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean originalsize = true
string picturename = "guardar2.gif"
string disabledname = "d_guardar2.gif"
end type

event clicked;if valida_prior()=false then return
if dw_p4_3.update()=-1 then 
	rollback;
else 
	commit;
end if

end event

type gb_5 from groupbox within tp_4
integer x = 1902
integer y = 640
integer width = 3401
integer height = 956
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 80269524
string text = "Planes de servicios"
end type

type cb_p4_get from picturebutton within tp_4
string tag = "Grupos Etareos"
integer x = 2222
integer y = 1448
integer width = 146
integer height = 128
integer taborder = 58
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean originalsize = true
string picturename = "getareo.gif"
string disabledname = "d_getareo.gif"
end type

event clicked;if dw_p4_3.rowcount()=0 then return
LONG fila
fila=dw_p4_3.getrow()
if dw_p4_3.update()=-1 then 
	rollback;
else 
	dw_p4_3.scrolltorow(fila)
	commit;
	open(w_contr_getareo)
end if
end event

type cb_p4_pri from picturebutton within tp_4
string tag = "Prioridades"
integer x = 2391
integer y = 1448
integer width = 146
integer height = 128
integer taborder = 68
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean originalsize = true
string picturename = "prioridades.gif"
end type

event clicked;dw_p4_3.setsort("tipo D")
dw_p4_3.sort()
long j
for j=1 to dw_p4_3.rowcount()
	dw_p4_3.setitem(j,"prioridad",j -1)
next
end event

type tp_5 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 5358
integer height = 1616
boolean enabled = false
long backcolor = 67108864
string text = "Configurar Planes"
long tabtextcolor = 33554432
string picturename = "configura.ico"
long picturemaskcolor = 536870912
string powertiptext = "Configuración de planes de servicios"
cb_p5_taf cb_p5_taf
cb_p5_cre cb_p5_cre
cb_p5_cmo cb_p5_cmo
cb_p5_cop cb_p5_cop
cb_3 cb_3
dw_p5_4 dw_p5_4
dw_p5_3 dw_p5_3
dw_p5_2 dw_p5_2
ddlb_2 ddlb_2
st_13 st_13
st_12 st_12
dw_p5_1 dw_p5_1
st_11 st_11
gb_6 gb_6
gb_7 gb_7
gb_8 gb_8
end type

on tp_5.create
this.cb_p5_taf=create cb_p5_taf
this.cb_p5_cre=create cb_p5_cre
this.cb_p5_cmo=create cb_p5_cmo
this.cb_p5_cop=create cb_p5_cop
this.cb_3=create cb_3
this.dw_p5_4=create dw_p5_4
this.dw_p5_3=create dw_p5_3
this.dw_p5_2=create dw_p5_2
this.ddlb_2=create ddlb_2
this.st_13=create st_13
this.st_12=create st_12
this.dw_p5_1=create dw_p5_1
this.st_11=create st_11
this.gb_6=create gb_6
this.gb_7=create gb_7
this.gb_8=create gb_8
this.Control[]={this.cb_p5_taf,&
this.cb_p5_cre,&
this.cb_p5_cmo,&
this.cb_p5_cop,&
this.cb_3,&
this.dw_p5_4,&
this.dw_p5_3,&
this.dw_p5_2,&
this.ddlb_2,&
this.st_13,&
this.st_12,&
this.dw_p5_1,&
this.st_11,&
this.gb_6,&
this.gb_7,&
this.gb_8}
end on

on tp_5.destroy
destroy(this.cb_p5_taf)
destroy(this.cb_p5_cre)
destroy(this.cb_p5_cmo)
destroy(this.cb_p5_cop)
destroy(this.cb_3)
destroy(this.dw_p5_4)
destroy(this.dw_p5_3)
destroy(this.dw_p5_2)
destroy(this.ddlb_2)
destroy(this.st_13)
destroy(this.st_12)
destroy(this.dw_p5_1)
destroy(this.st_11)
destroy(this.gb_6)
destroy(this.gb_7)
destroy(this.gb_8)
end on

type cb_p5_taf from picturebutton within tp_5
string tag = "Tipo Afiliado"
integer x = 4645
integer y = 1152
integer width = 146
integer height = 128
integer taborder = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean enabled = false
boolean originalsize = true
string picturename = "cuotata.gif"
string disabledname = "d_copago.gif"
alignment htextalign = left!
end type

event clicked;open(w_contr_tipo_afili)
end event

type cb_p5_cre from picturebutton within tp_5
string tag = "Cuota Recuperación"
integer x = 4471
integer y = 1152
integer width = 146
integer height = 128
integer taborder = 18
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean enabled = false
boolean originalsize = true
string picturename = "cuotar.gif"
string disabledname = "d_copago.gif"
alignment htextalign = left!
end type

event clicked;open(w_contrato_crecup)
end event

type cb_p5_cmo from picturebutton within tp_5
string tag = "Cuota Moderadora"
integer x = 4288
integer y = 1152
integer width = 146
integer height = 128
integer taborder = 18
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean enabled = false
boolean originalsize = true
string picturename = "cuotam.gif"
string disabledname = "d_copago.gif"
alignment htextalign = left!
end type

event clicked;open(w_contrato_cmodera)
end event

type cb_p5_cop from picturebutton within tp_5
string tag = "Copago"
integer x = 4114
integer y = 1152
integer width = 146
integer height = 128
integer taborder = 68
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean enabled = false
boolean originalsize = true
string picturename = "copago.gif"
string disabledname = "d_copago.gif"
alignment htextalign = left!
end type

event clicked;open(w_contrato_copago)
end event

type cb_3 from picturebutton within tp_5
string tag = "Guardar"
integer x = 4046
integer y = 1416
integer width = 146
integer height = 128
integer taborder = 58
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean originalsize = true
string picturename = "guardar2.gif"
string disabledname = "d_guardar2.gif"
end type

event clicked;if dw_p5_4.update()=-1 then 
	rollback;
else 
	commit;
end if
end event

type dw_p5_4 from datawindow within tp_5
integer x = 4078
integer y = 760
integer width = 654
integer height = 376
integer taborder = 4
string title = "none"
string dataobject = "dw_contrato_plan_reg"
boolean border = false
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event itemchanged;choose case this.getcolumnname()
	case "copago"
		this.setitem(row,"cuotamode",'0')
		this.setitem(row,"cuotarecu",'0')
		this.setitem(row,"tipoafil",'0')
		cb_p5_cmo.enabled=false
		cb_p5_cre.enabled=false
		cb_p5_taf.enabled=false
		if getitemstring(getrow(),'copago')='0' and data='1' then
			choose case messagebox('Atención', 'Esta operación eliminara todos los hijos',question!,okcancel!,1)
			case 1
				delete from contratoestcm where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Errorcontratoestcm",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If
				delete from contratoestcr where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Error contratoestcr",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If				
				delete from contratota where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Error contratota",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If
				this.setitem(this.getrow(),"copago",data)
			case 2
				this.setitem(this.getrow(),"copago",'0')
			end choose		
		end if
		if data='1' then
			cb_p5_cop.enabled=true
		else
			cb_p5_cop.enabled=false
		end if
	
	case "cuotamode"
		this.setitem(row,"copago",'0')
		this.setitem(row,"cuotarecu",'0')
		this.setitem(row,"tipoafil",'0')
		cb_p5_cop.enabled=false
		cb_p5_cre.enabled=false
		cb_p5_taf.enabled=false
		if getitemstring(getrow(),'cuotamode')='0' and data='1' then
			choose case messagebox('Atención', 'Esta operación eliminara todos los hijos',question!,okcancel!,1)
			case 1
				delete from contratoestc where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Errorcontratoestc",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If
				delete from contratoestcr where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Error contratoestcr",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If				
				delete from contratota where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Error contratota",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If
				this.setitem(this.getrow(),"cuotamode",data)
			case 2
				this.setitem(this.getrow(),"cuotamode",'0')
			end choose		
		end if		
		if data='1' then
			cb_p5_cmo.enabled=true
		else
			cb_p5_cmo.enabled=false
		end if
	case "cuotarecu"
		this.setitem(row,"copago",'0')
		this.setitem(row,"cuotamode",'0')
		this.setitem(row,"tipoafil",'0')
		cb_p5_cop.enabled=false
		cb_p5_cmo.enabled=false
		cb_p5_taf.enabled=false
		if getitemstring(getrow(),'cuotarecu')='0' and data='1' then
			choose case messagebox('Atención', 'Esta operación eliminara todos los hijos',question!,okcancel!,1)
			case 1
				delete from contratoestc where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Errorcontratoestc",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If
				delete from contratoestcm where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Error contratoestcm",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If				
				delete from contratota where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Error contratota",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If
				this.setitem(this.getrow(),"cuotarecu",data)
			case 2
				this.setitem(this.getrow(),"cuotarecu",'0')
			end choose		
		end if				
		if data='1' then
			cb_p5_cre.enabled=true
		else
			cb_p5_cre.enabled=false
		end if
	case "pagopart"
		this.setitem(row,"copago",'0')
		this.setitem(row,"cuotamode",'0')
		this.setitem(row,"cuotarecu",'0')
		this.setitem(row,"tipoafil",'0')
		if getitemstring(getrow(),'pagopart')='0' and data='1' then
			choose case messagebox('Atención', 'Esta operación eliminara todos los hijos',question!,okcancel!,1)
			case 1
				delete from contratoestc where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Errorcontratoestc",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If
				delete from contratoestcr where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Error contratoestcr",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If				
				delete from contratoestcm where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Error contratota",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If
				delete from contratota where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Error contratota",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If				
				this.setitem(this.getrow(),"pagopart",data)
			case 2
				this.setitem(this.getrow(),"pagopart",'0')
			end choose		
		end if			
		
		cb_p5_cop.enabled=false
		cb_p5_cmo.enabled=false
		cb_p5_cre.enabled=false
		cb_p5_taf.enabled=false
	case "tipoafil"
		this.setitem(row,"copago",'0')
		this.setitem(row,"cuotamode",'0')
		this.setitem(row,"cuotarecu",'0')
		this.setitem(row,"pagopart",'0')
		cb_p5_cop.enabled=false
		cb_p5_cmo.enabled=false
		cb_p5_cre.enabled=false
		if getitemstring(getrow(),'tipoafil')='0' and data='1' then
			choose case messagebox('Atención', 'Esta operación eliminara todos los hijos',question!,okcancel!,1)
			case 1
				delete from contratoestc where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Errorcontratoestc",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If
				delete from contratoestcr where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Error contratoestcr",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If				
				delete from contratoestcm where  cemp=:empres and ccontrato=:i_contrat and cplan=:i_plan and codtingre=:tipoingreso and tipo=:i_tipo;
				If sqlca.sqlcode=-1 then
	  				messagebox("Error contratota",sqlca.sqlerrtext)
	  				rollback;
	   				return
				Else
					commit;
				End If
				this.setitem(this.getrow(),"tipoafil",data)
			case 2
				this.setitem(this.getrow(),"tipoafil",'0')
			end choose		
		end if		
		if data='1' then
			cb_p5_taf.enabled=true
		else
			cb_p5_taf.enabled=false
		end if
end choose
this.accepttext()
end event

event retrieveend;if this.getitemstring(this.getrow(),6)="1" then cb_p5_cop.enabled=true
if this.getitemstring(this.getrow(),7)="1" then cb_p5_cmo.enabled=true
if this.getitemstring(this.getrow(),8)="1" then cb_p5_cre.enabled=true
if this.getitemstring(this.getrow(),10)="1" then cb_p5_taf.enabled=true
end event

event constructor;this.settransobject(sqlca)
end event

type dw_p5_3 from datawindow within tp_5
integer x = 1920
integer y = 860
integer width = 1984
integer height = 672
integer taborder = 3
string title = "none"
string dataobject = "dw_lista_contratos_planes"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event retrieveend;this.triggerevent(rowfocuschanged!)
end event

event rowfocuschanged;long fila
if this.rowcount()=0 then return
fila=this.getrow()
this.selectrow(0,false)
this.selectrow(fila,true)
if fila<1 then return
cb_p5_cop.enabled=false
cb_p5_cre.enabled=false
cb_p5_cmo.enabled=false
cb_p5_taf.enabled=false
i_plan=this.getitemstring(fila,3)
i_tipo=this.getitemstring(fila,5)
dw_p5_4.retrieve(empres,i_contrat,this.getitemstring(fila,3),this.getitemstring(fila,4),this.getitemstring(fila,5))
end event

event constructor;this.settransobject(sqlca)
end event

type dw_p5_2 from datawindow within tp_5
integer x = 46
integer y = 716
integer width = 1774
integer height = 844
integer taborder = 1
string title = "none"
string dataobject = "dw_lista_contratos"
boolean hscrollbar = true
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event rowfocuschanged;long fila
if rowcount()=0 then return
fila=getrow()
selectrow(0,false)
selectrow(fila,true)
if fila<1 then return
if l_contrato='1' then
	if lugar_seg=dw_p5_2.getitemstring(fila,'clugar') then
		dw_p5_3.enabled=true
		i_contrat=getitemstring(fila,2)
		dw_p5_3.retrieve(empres,i_contrat)
		ddlb_2.triggerevent(selectionchanged!)
	else
		dw_p5_3.enabled=false	
	end if
else 
	dw_p5_3.enabled=true
	i_contrat=getitemstring(fila,2)
	dw_p5_3.retrieve(empres,i_contrat)
	ddlb_2.triggerevent(selectionchanged!)
end if
end event

event constructor;this.settransobject(sqlca)
end event

type ddlb_2 from dropdownlistbox within tp_5
integer x = 2400
integer y = 728
integer width = 795
integer height = 400
integer taborder = 2
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "none"
boolean sorted = false
boolean vscrollbar = true
string item[] = {"CONSULTA EXTERNA","URGENCIAS","HOSPITALIZACIÓN","AMBULATORIO","UCI"}
borderstyle borderstyle = stylelowered!
end type

event constructor;this.text="CONSULTA EXTERNA"
end event

event selectionchanged;choose case this.text
	case "CONSULTA EXTERNA"
		tipoingreso='1'
	case 'URGENCIAS'
		tipoingreso='2'
	case 'HOSPITALIZACIÓN'
		tipoingreso='3'
	case 'AMBULATORIO'
		tipoingreso='4'
	case 'UCI'
		tipoingreso='7'	
end choose
dw_p5_3.setfilter("codtingre='"+tipoingreso+"'")
dw_p5_3.filter()

end event

type st_13 from statictext within tp_5
integer x = 1938
integer y = 756
integer width = 343
integer height = 64
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Tipo Ingreso:"
boolean focusrectangle = false
end type

type st_12 from statictext within tp_5
integer x = 41
integer y = 512
integer width = 5179
integer height = 116
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 8388608
long backcolor = 134217752
string text = "Los planes de servicio, según el tipo de ingreso, pueden tener reglas de juego en cuanto al cobro de copagos o de cuotas moderadoras, segun el estrato o categoria del paciente"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type dw_p5_1 from datawindow within tp_5
integer x = 32
integer y = 88
integer width = 4046
integer height = 384
string title = "none"
string dataobject = "dw_empresa"
boolean border = false
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
end event

type st_11 from statictext within tp_5
integer x = 101
integer width = 1659
integer height = 88
integer textsize = -14
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 8388608
long backcolor = 80269524
string text = "Configuración de planes de servicios"
boolean focusrectangle = false
end type

type gb_6 from groupbox within tp_5
integer x = 4023
integer y = 660
integer width = 969
integer height = 676
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Reglas de Juego"
borderstyle borderstyle = styleraised!
end type

type gb_7 from groupbox within tp_5
integer x = 14
integer y = 652
integer width = 1842
integer height = 944
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Contratos"
borderstyle borderstyle = styleraised!
end type

type gb_8 from groupbox within tp_5
integer x = 1888
integer y = 660
integer width = 2075
integer height = 924
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Planes de Servicios"
borderstyle borderstyle = styleraised!
end type

