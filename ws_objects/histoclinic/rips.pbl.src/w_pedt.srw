$PBExportHeader$w_pedt.srw
forward
global type w_pedt from window
end type
type st_8 from statictext within w_pedt
end type
type st_21 from statictext within w_pedt
end type
type dw_getar from datawindow within w_pedt
end type
type dw_temp from datawindow within w_pedt
end type
type dw_det_lote from datawindow within w_pedt
end type
type dw_export from datawindow within w_pedt
end type
type dw_trae from datawindow within w_pedt
end type
type tab_2 from tab within w_pedt
end type
type tp2_1 from userobject within tab_2
end type
type t1 from tab within tp2_1
end type
type tp1 from userobject within t1
end type
type dw_ria from datawindow within tp1
end type
type cbx_replica from checkbox within tp1
end type
type st_10 from statictext within tp1
end type
type st_2 from statictext within tp1
end type
type st_3 from statictext within tp1
end type
type st_4 from statictext within tp1
end type
type st_5 from statictext within tp1
end type
type st_6 from statictext within tp1
end type
type pb_buscar from picturebutton within tp1
end type
type st_cuantos from statictext within tp1
end type
type st_11 from statictext within tp1
end type
type stt_diag from statictext within tp1
end type
type pb_ayuda from picturebutton within tp1
end type
type pb_guardar from picturebutton within tp1
end type
type pb_trae from picturebutton within tp1
end type
type drop_tipo from dropdownlistbox within tp1
end type
type st_7 from statictext within tp1
end type
type gb_2 from groupbox within tp1
end type
type st_tdoc from statictext within tp1
end type
type st_docu from statictext within tp1
end type
type st_paciente from statictext within tp1
end type
type st_sexo from statictext within tp1
end type
type st_edad from statictext within tp1
end type
type st_nfact from statictext within tp1
end type
type tp1 from userobject within t1
dw_ria dw_ria
cbx_replica cbx_replica
st_10 st_10
st_2 st_2
st_3 st_3
st_4 st_4
st_5 st_5
st_6 st_6
pb_buscar pb_buscar
st_cuantos st_cuantos
st_11 st_11
stt_diag stt_diag
pb_ayuda pb_ayuda
pb_guardar pb_guardar
pb_trae pb_trae
drop_tipo drop_tipo
st_7 st_7
gb_2 gb_2
st_tdoc st_tdoc
st_docu st_docu
st_paciente st_paciente
st_sexo st_sexo
st_edad st_edad
st_nfact st_nfact
end type
type t1 from tab within tp2_1
tp1 tp1
end type
type tab_1 from tab within tp2_1
end type
type tp_1 from userobject within tab_1
end type
type em_anyo from editmask within tp_1
end type
type trimestre from dropdownlistbox within tp_1
end type
type pb_2 from picturebutton within tp_1
end type
type pb_1 from picturebutton within tp_1
end type
type dw_empresa from datawindow within tp_1
end type
type pb_3 from picturebutton within tp_1
end type
type st_1 from statictext within tp_1
end type
type dw_radica_rips from datawindow within tp_1
end type
type cbx_activos from checkbox within tp_1
end type
type tp_1 from userobject within tab_1
em_anyo em_anyo
trimestre trimestre
pb_2 pb_2
pb_1 pb_1
dw_empresa dw_empresa
pb_3 pb_3
st_1 st_1
dw_radica_rips dw_radica_rips
cbx_activos cbx_activos
end type
type tp_p from userobject within tab_1
end type
type st_20 from statictext within tp_p
end type
type st_19 from statictext within tp_p
end type
type dw_det from datawindow within tp_p
end type
type dw_radica from datawindow within tp_p
end type
type pb_radvi from picturebutton within tp_p
end type
type pb_anula from picturebutton within tp_p
end type
type tp_p from userobject within tab_1
st_20 st_20
st_19 st_19
dw_det dw_det
dw_radica dw_radica
pb_radvi pb_radvi
pb_anula pb_anula
end type
type tab_1 from tab within tp2_1
tp_1 tp_1
tp_p tp_p
end type
type rb_defecto from radiobutton within tp2_1
end type
type sle_dir from singlelineedit within tp2_1
end type
type cb_dir from commandbutton within tp2_1
end type
type tp2_1 from userobject within tab_2
t1 t1
tab_1 tab_1
rb_defecto rb_defecto
sle_dir sle_dir
cb_dir cb_dir
end type
type tp2_2 from userobject within tab_2
end type
type cbx_3 from checkbox within tp2_2
end type
type rb_6 from radiobutton within tp2_2
end type
type rb_5 from radiobutton within tp2_2
end type
type pb_lote from picturebutton within tp2_2
end type
type st_18 from statictext within tp2_2
end type
type st_17 from statictext within tp2_2
end type
type sle_log from singlelineedit within tp2_2
end type
type st_16 from statictext within tp2_2
end type
type cb_1 from commandbutton within tp2_2
end type
type st_15 from statictext within tp2_2
end type
type sle_sale from singlelineedit within tp2_2
end type
type rb_tod from radiobutton within tp2_2
end type
type rb_activ from radiobutton within tp2_2
end type
type st_14 from statictext within tp2_2
end type
type dw_cont from datawindow within tp2_2
end type
type st_13 from statictext within tp2_2
end type
type dw_emp from datawindow within tp2_2
end type
type st_12 from statictext within tp2_2
end type
type em_4 from editmask within tp2_2
end type
type em_3 from editmask within tp2_2
end type
type gb_7 from groupbox within tp2_2
end type
type gb_9 from groupbox within tp2_2
end type
type tp2_2 from userobject within tab_2
cbx_3 cbx_3
rb_6 rb_6
rb_5 rb_5
pb_lote pb_lote
st_18 st_18
st_17 st_17
sle_log sle_log
st_16 st_16
cb_1 cb_1
st_15 st_15
sle_sale sle_sale
rb_tod rb_tod
rb_activ rb_activ
st_14 st_14
dw_cont dw_cont
st_13 st_13
dw_emp dw_emp
st_12 st_12
em_4 em_4
em_3 em_3
gb_7 gb_7
gb_9 gb_9
end type
type tab_2 from tab within w_pedt
tp2_1 tp2_1
tp2_2 tp2_2
end type
end forward

global type w_pedt from window
integer width = 4123
integer height = 3332
boolean titlebar = true
string title = "Generador de Actividades Protección Especifica y Detección Temprana"
boolean controlmenu = true
boolean minbox = true
boolean maxbox = true
boolean resizable = true
windowtype windowtype = child!
long backcolor = 67108864
string icon = "rips.ico"
st_8 st_8
st_21 st_21
dw_getar dw_getar
dw_temp dw_temp
dw_det_lote dw_det_lote
dw_export dw_export
dw_trae dw_trae
tab_2 tab_2
end type
global w_pedt w_pedt

type variables
datawindowchild idw_contrato,idw_emp
long i_NRO_DIG,i_numarc
string anterior,orden,CONCATENA_FAC,i_decual
date ini,fin
end variables

forward prototypes
public subroutine cuenta ()
public function long lf_trae_ndoc (string p_decual)
public function integer genera_furips (double p_nrad, string p_clug_rad, datetime p_fecha_fin, boolean p_faltan)
public function integer f_rips (boolean p_faltan, long p_nradica, string p_clug_rad, datawindow p_dw_conts, string p_decual, boolean p_cups, long p_cero, string p_por_lugar, string p_reserva)
end prototypes

public subroutine cuenta ();tab_2.tp2_1.t1.tp1.st_cuantos.text=string(tab_2.tp2_1.t1.tp1.dw_ria.rowcount())+" registro(s)"
end subroutine

public function long lf_trae_ndoc (string p_decual);long ndoc,n_ini,n_fin
string err,por_lug,p_cdoc='RPT',p_desdoc='Radicaciones',p_clug
p_clug=clugar
select por_lugar,numini,numfin,nactual into :por_lug,:n_ini,:n_fin,:ndoc from documentos_gral where coddoc=:p_cdoc;
if sqlca.sqlcode=-1 then 
	err=sqlca.sqlerrtext
	rollback;
	if p_decual='lote' then
		filewrite(i_numarc,'Error leyendo documentos_gral '+err)
	else
		messagebox('Error leyendo documentos_gral',err)
	end if
	return -1
end if
if sqlca.sqlnrows=0 then
	rollback;
	if p_decual='lote' then
		filewrite(i_numarc,'El Documento ('+p_cdoc+')'+p_desdoc+' no existe en la tabla Documentos_gral, debe crearlo para continuar~r~n')
	else
		messagebox('Atención','El Documento ('+p_cdoc+')'+p_desdoc+' no existe en la tabla Documentos_gral, debe crearlo para continuar')
	end if
	return -1
end if
if isnull(ndoc) then ndoc=0
if por_lug='1' then
	select nactual,numini,numfin into :ndoc ,:n_ini ,:n_fin from documentos where coddoc=:p_cdoc and clugar=:p_clug;
	if sqlca.sqlcode=-1 then 
		err=sqlca.sqlerrtext
		rollback;
		if p_decual='lote' then
			filewrite(i_numarc,'Error leyendo documentos: '+err)
		else
			messagebox('Error leyendo documentos',err)
		end if
		return -1
	end if
	if sqlca.sqlnrows=0 then
		rollback;
		if p_decual='lote' then
			filewrite(i_numarc,'El Documento ('+p_cdoc+')'+p_desdoc+' no existe en la tabla Documentos, debe crearlo para continuar')
		else
			messagebox('Atención','El Documento ('+p_cdoc+')'+p_desdoc+' no existe en la tabla Documentos, debe crearlo para continuar')
		end if
		return -1
	end if
	if isnull(ndoc) then ndoc=0
end if
ndoc++
if ndoc<n_ini or ndoc>n_fin then
	rollback;
	if p_decual='lote' then
		filewrite(i_numarc,'El número que se generará no está dentro del rando definido para el documento: '+p_cdoc)
	else
		messagebox('Atención','El número que se generará no está dentro del rando definido para el documento: '+p_cdoc)
	end if
	return -1
end if
if por_lug='1' then
	update documentos set nactual=:ndoc where coddoc=:p_cdoc and clugar=:p_clug and nactual=:ndoc -1 ;
else
	update documentos_gral set nactual=:ndoc where coddoc=:p_cdoc and nactual=:ndoc -1 ;
end if
if sqlca.sqlcode=-1 then
	err=sqlca.sqlerrtext
	rollback;
	if p_decual='lote' then
		filewrite(i_numarc,'Error actualizando documentos '+err)
	else
		messagebox('Error actualizando documentos',err)
	end if
	return -1
end if
if sqlca.sqlnrows=0 then
	rollback;
	if p_decual='lote' then
		filewrite(i_numarc,'Error generando nuevo Documento. Es posible que el número ya haya sido utilizado, intente nuevamente')
	else
		messagebox('Error generando nuevo Documento','Es posible que el número ya haya sido utilizado, intente nuevamente')
	end if
	return -1
end if
return ndoc
end function

public function integer genera_furips (double p_nrad, string p_clug_rad, datetime p_fecha_fin, boolean p_faltan);string nom_arch,docname,real_name[3],habi,dia,mes,anyo
long j,i,nro_regs[3]
boolean hubo=false

if day(date(p_fecha_fin)) <10 then 
	dia='0'+string(day(date(p_fecha_fin))) 
else 
	dia=string(day(date(p_fecha_fin))) 
end if

if month(date(p_fecha_fin)) <10 then 
	mes='0'+string(month(date(p_fecha_fin))) 
else 
	mes=string(month(date(p_fecha_fin))) 
end if

anyo=string(year(date(p_fecha_fin)))

////////////////////// furips01
dw_trae.dataobject="dr_furips_01"
dw_trae.settransobject(sqlca)
if dw_trae.retrieve(p_nrad,p_clug_rad)>0 then
	habi=dw_trae.getitemstring(1,'Codhabi')
	nro_regs[1]=dw_trae.rowcount()
	hubo=true
	dw_export.dataobject="dr_export_furips_01"
	for j=1 to dw_trae.rowcount()
		i=dw_export.insertrow(0)
		dw_export.setitem(i,'rad_ant',dw_trae.getitemstring(j,'rg'))
		dw_export.setitem(i,'rg',dw_trae.getitemstring(j,'rgr'))
		dw_export.setitem(i,'factura',dw_trae.getitemstring(j,'nfact'))
		dw_export.setitem(i,'reclamacion',dw_trae.getitemstring(j,'conse'))
		dw_export.setitem(i,'prestador',dw_trae.getitemstring(j,'codhabi'))
		dw_export.setitem(i,'Papell_vic',f_quita_basura(dw_trae.getitemstring(j,'apellido1'),1))
		dw_export.setitem(i,'sapell_vic',f_quita_basura(dw_trae.getitemstring(j,'apellido2'),1))
		dw_export.setitem(i,'pnom_vic',f_quita_basura(dw_trae.getitemstring(j,'nombre1'),1))
		dw_export.setitem(i,'snom_vic',f_quita_basura(dw_trae.getitemstring(j,'nombre2'),1))
		dw_export.setitem(i,'td',dw_trae.getitemstring(j,'TDOC_PAC'))
		dw_export.setitem(i,'doc',dw_trae.getitemstring(j,'DOCU_PACIENTE'))
		dw_export.setitem(i,'fechanac',dw_trae.getitemstring(j,'fnacimiento'))
		dw_export.setitem(i,'sexo',dw_trae.getitemstring(j,'sexo'))
		dw_export.setitem(i,'dir_vic',left(f_quita_basura(dw_trae.getitemstring(j,'DIR_PACIENTE'),0),40))
		dw_export.setitem(i,'depto_vic',dw_trae.getitemstring(j,'cdpto_pac'))
		dw_export.setitem(i,'mcpio_vic',dw_trae.getitemstring(j,'CdCIUD_pac'))
		dw_export.setitem(i,'tele_vic',left(f_quita_basura(dw_trae.getitemstring(j,'TEL_PACIENTE'),0),10))
		dw_export.setitem(i,'cond',dw_trae.getitemstring(j,'cod_acci'))
		dw_export.setitem(i,'natura',dw_trae.getitemstring(j,'natura'))
		dw_export.setitem(i,'desrip',dw_trae.getitemstring(j,'descp_evento'))
		dw_export.setitem(i,'dir_eve',left(f_quita_basura(dw_trae.getitemstring(j,'sitio_acc'),0),40))
		dw_export.setitem(i,'fecha_eve',dw_trae.getitemstring(j,'fechaacc'))
		dw_export.setitem(i,'hora_eve',dw_trae.getitemstring(j,'horaacc'))
		dw_export.setitem(i,'depto_eve',dw_trae.getitemstring(j,'cd_Dpto_acci'))
		dw_export.setitem(i,'mcpio_eve',dw_trae.getitemstring(j,'cd_ciud_acci'))
		dw_export.setitem(i,'zona_eve',dw_trae.getitemstring(j,'zona'))
		dw_export.setitem(i,'estado',dw_trae.getitemstring(j,'asegurado'))
		dw_export.setitem(i,'marca',dw_trae.getitemstring(j,'marca'))
		dw_export.setitem(i,'placa',f_quita_basura(dw_trae.getitemstring(j,'placa_acc'),0))
		dw_export.setitem(i,'Tvehi',dw_trae.getitemstring(j,'tipo_vehi'))
		dw_export.setitem(i,'cod_aseg',dw_trae.getitemstring(j,'cod_ase'))
		dw_export.setitem(i,'poliza',f_quita_basura(dw_trae.getitemstring(j,'npoliza'),0))
		dw_export.setitem(i,'fecha_ini',dw_trae.getitemstring(j,'desde'))
		dw_export.setitem(i,'fecha_ven',dw_trae.getitemstring(j,'hasta'))
		dw_export.setitem(i,'autoridad',dw_trae.getitemstring(j,'autoridad'))
		dw_export.setitem(i,'excedente',dw_trae.getitemstring(j,'cexc'))
		dw_export.setitem(i,'placa2',dw_trae.getitemstring(j,'placa2'))
		dw_export.setitem(i,'td_2',dw_trae.getitemstring(j,'td2p'))
		dw_export.setitem(i,'doc_2',dw_trae.getitemstring(j,'d2p'))
		dw_export.setitem(i,'placa3',dw_trae.getitemstring(j,'placa3'))
		dw_export.setitem(i,'td_3',dw_trae.getitemstring(j,'td3p'))
		dw_export.setitem(i,'doc_3',dw_trae.getitemstring(j,'d3p'))
		dw_export.setitem(i,'td_pro',dw_trae.getitemstring(j,'tdoc_prop'))
		dw_export.setitem(i,'doc_pro',dw_trae.getitemstring(j,'docu_prop'))
		dw_export.setitem(i,'Papell_pro',f_quita_basura(dw_trae.getitemstring(j,'ape1_prop'),1))
		dw_export.setitem(i,'sapell_pro',f_quita_basura(dw_trae.getitemstring(j,'ape2_prop'),1))
		dw_export.setitem(i,'pnom_pro',f_quita_basura(dw_trae.getitemstring(j,'nom1_prop'),1))
		dw_export.setitem(i,'snom_pro',f_quita_basura(dw_trae.getitemstring(j,'nom2_prop'),1))
		dw_export.setitem(i,'dir_pro',left(f_quita_basura(dw_trae.getitemstring(j,'direcc_prop'),0),40))
		dw_export.setitem(i,'tel_pro',dw_trae.getitemstring(j,'tel_prop'))
		dw_export.setitem(i,'depto_pro',dw_trae.getitemstring(j,'dept_prop'))
		dw_export.setitem(i,'mcpio_pro',dw_trae.getitemstring(j,'coddp_pro'))
		dw_export.setitem(i,'Papell_con',f_quita_basura(dw_trae.getitemstring(j,'apellidos_cond'),1))
		dw_export.setitem(i,'sapell_con',f_quita_basura(dw_trae.getitemstring(j,'ape2_cond'),1))
		dw_export.setitem(i,'pnom_con',f_quita_basura(dw_trae.getitemstring(j,'nombres_cond'),1))
		dw_export.setitem(i,'snom_con',f_quita_basura(dw_trae.getitemstring(j,'nom2_cond'),1))
		dw_export.setitem(i,'td_con',dw_trae.getitemstring(j,'tdoc_cond'))
		dw_export.setitem(i,'doc_con',dw_trae.getitemstring(j,'docu_cond'))
		dw_export.setitem(i,'dir_con',left(f_quita_basura(dw_trae.getitemstring(j,'direcc_cond'),0),40))
		dw_export.setitem(i,'depto_con',dw_trae.getitemstring(j,'coddp_cod'))
		dw_export.setitem(i,'mcpio_con',dw_trae.getitemstring(j,'cod_ciu_con'))
		dw_export.setitem(i,'tel_con',dw_trae.getitemstring(j,'tel_cond'))
		dw_export.setitem(i,'referen',dw_trae.getitemstring(j,'tiref'))
		dw_export.setitem(i,'fecha_remi',dw_trae.getitemstring(j,'feremi'))
		dw_export.setitem(i,'hora_salida',dw_trae.getitemstring(j,'horemi'))
		dw_export.setitem(i,'prestador_rem',dw_trae.getitemstring(j,'codhabirem'))
		dw_export.setitem(i,'profe_remite',dw_trae.getitemstring(j,'prof_rem'))
		dw_export.setitem(i,'cargo_remite',f_quita_basura(dw_trae.getitemstring(j,'desesp'),0))
		dw_export.setitem(i,'fecha_ingreso_rem',dw_trae.getitemstring(j,'fe_ing_rem'))
		dw_export.setitem(i,'hora_ingreso_rem',dw_trae.getitemstring(j,'ho_ing_rem'))
		dw_export.setitem(i,'prestador_recibe',dw_trae.getitemstring(j,'csupe_ipsrem'))
		dw_export.setitem(i,'profe_recibe',dw_trae.getitemstring(j,'prof_recibe'))
		dw_export.setitem(i,'cargo_recibe',f_quita_basura(dw_trae.getitemstring(j,'cargo_profe_recibe'),0))
		dw_export.setitem(i,'placa_mov',dw_trae.getitemstring(j,'placa_trans'))
		dw_export.setitem(i,'recorrido_1',dw_trae.getitemstring(j,'trans_desde'))
		dw_export.setitem(i,'recorrido_2',dw_trae.getitemstring(j,'trans_hasta'))
		dw_export.setitem(i,'ambulancia',dw_trae.getitemstring(j,'tipo_trans'))
		dw_export.setitem(i,'zona_recoge',dw_trae.getitemstring(j,'zona_t'))
		dw_export.setitem(i,'fecha_ingreso',dw_trae.getitemstring(j,'fing'))
		dw_export.setitem(i,'hora__ingreso',dw_trae.getitemstring(j,'hing'))
		dw_export.setitem(i,'fecha_egreso',dw_trae.getitemstring(j,'feg'))
		dw_export.setitem(i,'hora_egreso',dw_trae.getitemstring(j,'heg'))
		dw_export.setitem(i,'dxip',dw_trae.getitemstring(j,'diaing'))
		dw_export.setitem(i,'dxi1',dw_trae.getitemstring(j,'di1'))
		dw_export.setitem(i,'dxi2',dw_trae.getitemstring(j,'di2'))
		dw_export.setitem(i,'dxep',dw_trae.getitemstring(j,'deg'))
		dw_export.setitem(i,'dxe1',dw_trae.getitemstring(j,'ge1'))
		dw_export.setitem(i,'dex2',dw_trae.getitemstring(j,'de2'))
		dw_export.setitem(i,'Papell_med',dw_trae.getitemstring(j,'pro_at_a1'))
		dw_export.setitem(i,'sapell_med',dw_trae.getitemstring(j,'pro_at_a2'))
		dw_export.setitem(i,'pnom_med',dw_trae.getitemstring(j,'pro_at_n1'))
		dw_export.setitem(i,'snom_med',dw_trae.getitemstring(j,'pro_at_n2'))
		dw_export.setitem(i,'td_med',dw_trae.getitemstring(j,'pro_at_td'))
		dw_export.setitem(i,'doc_med',dw_trae.getitemstring(j,'pro_at_doc'))
		dw_export.setitem(i,'reg_med',f_quita_basura(dw_trae.getitemstring(j,'pro_at_reg'),0))
		dw_export.setitem(i,'fact_gas_med',dw_trae.getitemstring(j,'vtproce'))
		dw_export.setitem(i,'total_gas_med',dw_trae.getitemstring(j,'vtemp'))
		dw_export.setitem(i,'fac_mov',dw_trae.getitemstring(j,'gt1'))
		dw_export.setitem(i,'total_mov',dw_trae.getitemstring(j,'gt2'))
		if isnull(dw_trae.getitemstring(j,'folios')) then
			dw_export.setitem(i,'folios',1)
		else
			dw_export.setitem(i,'folios',dw_trae.getitemstring(j,'folios'))
		end if
	next
	nom_arch="furips1"+habi+dia+mes+anyo
	docname=nom_arch
	docname=tab_2.tp2_1.sle_dir.text+'\'+nom_arch+'.txt'
	nom_arch+='.txt'
	if dw_export.saveas(docname,CSV!,false)=-1 then
		if p_faltan then
			Messagebox("Error guardando furips1","No se puede guardar el archivo, revise el espacio o el estado del disco.~r~nLa radiciación generará aún así.")
		else
			Messagebox("Error guardando Furips1","No se puede guardar el archivo, revise el espacio o el estado del disco.")
		end if
	else
		f_quita_espacio_rips(docname)
	end if
	real_name[1]=mid(nom_arch,1,len(nom_arch) -4)
	////////////////////// fin furips1

	////////////////////// furips02
	dw_trae.dataobject="dr_furips_02"
	dw_trae.settransobject(sqlca)
	if dw_trae.retrieve(p_nrad,p_clug_rad)>0 then
		nro_regs[1]=dw_trae.rowcount()
		hubo=true
		dw_export.dataobject="dr_export_furips_02"
		for j=1 to dw_trae.rowcount()
			i=dw_export.insertrow(0)
			dw_export.setitem(i,'factura',dw_trae.getitemstring(j,'nfact'))
			dw_export.setitem(i,'consecu',dw_trae.getitemstring(j,'conse'))
			dw_export.setitem(i,'tipo_serv',dw_trae.getitemstring(j,'furips'))
			if dw_trae.getitemstring(j,'furips')='4' or dw_trae.getitemstring(j,'furips')='5' then
				dw_export.setitem(i,'codigo_serv','')
			else			
				dw_export.setitem(i,'codigo_serv',dw_trae.getitemstring(j,'codigo'))
			end if
			if  dw_trae.getitemstring(j,'furips')='5' then
				dw_export.setitem(i,'descripcion',left(f_quita_basura(dw_trae.getitemstring(j,'descrip'),1),40))
			else
				dw_export.setitem(i,'descripcion','')
			end if
			dw_export.setitem(i,'cantidad',dw_trae.getitemstring(j,'cant'))
			dw_export.setitem(i,'valor_unitario',dw_trae.getitemstring(j,'Vunit'))
			dw_export.setitem(i,'valor_facturado',dw_trae.getitemstring(j,'vfactu'))
			dw_export.setitem(i,'fosyga',dw_trae.getitemstring(j,'vfsyga'))
	next
	nom_arch="furips2"+habi+dia+mes+anyo
	docname=nom_arch
	docname=tab_2.tp2_1.sle_dir.text+'\'+nom_arch+'.txt'
	nom_arch+='.txt'
	if dw_export.saveas(docname,CSV!,false)=-1 then
		if p_faltan then
			Messagebox("Error guardando Furips2","No se puede guardar el archivo, revise el espacio o el estado del disco.~r~nLa radiciación generará aún así.")
		else
			Messagebox("Error guardando Furips2","No se puede guardar el archivo, revise el espacio o el estado del disco.")
		end if
	else
		f_quita_espacio_rips(docname)
	end if
	real_name[1]=mid(nom_arch,1,len(nom_arch) -4)
	////////////////////// fin furips2
	end if

	////////////////////// furtran
	dw_trae.dataobject="dr_furips_01"
	dw_trae.settransobject(sqlca)
	if dw_trae.retrieve(p_nrad,p_clug_rad)>0 then
		nro_regs[1]=dw_trae.rowcount()
		hubo=true
		dw_export.dataobject="dr_export_futran"
		for j=1 to dw_trae.rowcount()
			if not isnull(dw_trae.getitemstring(j,'placa_trans')) and dw_trae.getitemstring(j,'placa_trans')<>''  then
				i=dw_export.insertrow(0)
				dw_export.setitem(i,'rad_ant',dw_trae.getitemstring(j,'rg'))
				dw_export.setitem(i,'rg',dw_trae.getitemstring(j,'rgr'))
				dw_export.setitem(i,'nomempresa',f_quita_basura(dw_trae.getitemstring(j,'ipsn'),0))
				dw_export.setitem(i,'prestador',dw_trae.getitemstring(j,'codhabi'))
				dw_export.setitem(i,'papell_rec','')
				dw_export.setitem(i,'sapell_rec','')
				dw_export.setitem(i,'pnom_rec','')
				dw_export.setitem(i,'snom_rec','')
				dw_export.setitem(i,'td_rec',dw_trae.getitemstring(j,'ips_td'))
				dw_export.setitem(i,'doc_rec',dw_trae.getitemstring(j,'ips_doc'))
				dw_export.setitem(i,'tiposerv',dw_trae.getitemstring(j,'tipo_trans'))
				dw_export.setitem(i,'otro','')
				dw_export.setitem(i,'placaa',dw_trae.getitemstring(j,'placa_trans'))
				dw_export.setitem(i,'direcc',f_quita_basura(dw_trae.getitemstring(j,'dir_ips'),0))
				dw_export.setitem(i,'tele',left(f_quita_basura(dw_trae.getitemstring(j,'tel_ips'),0),10))
				dw_export.setitem(i,'cod_dep',dw_trae.getitemstring(j,'depto_ips'))
				dw_export.setitem(i,'cod_mcpio',dw_trae.getitemstring(j,'ciudad_ips'))
				dw_export.setitem(i,'td_v',dw_trae.getitemstring(j,'TDOC_PAC'))
				dw_export.setitem(i,'docu_vic',dw_trae.getitemstring(j,'DOCU_PACIENTE'))
				dw_export.setitem(i,'papell_v',f_quita_basura(dw_trae.getitemstring(j,'apellido1'),1))
				dw_export.setitem(i,'sapell_v',f_quita_basura(dw_trae.getitemstring(j,'apellido2'),1))
				dw_export.setitem(i,'pnom_v',f_quita_basura(dw_trae.getitemstring(j,'nombre1'),1))
				dw_export.setitem(i,'snom_v',f_quita_basura(dw_trae.getitemstring(j,'nombre2'),1))
				dw_export.setitem(i,'tipoevento','1')
				dw_export.setitem(i,'dir_reg',left(f_quita_basura(dw_trae.getitemstring(j,'sitio_acc'),0),40))
				dw_export.setitem(i,'cod_dep_reg',dw_trae.getitemstring(j,'cd_Dpto_acci'))
				dw_export.setitem(i,'cod_mcpio_reg',dw_trae.getitemstring(j,'cd_ciud_acci'))
				dw_export.setitem(i,'zona_reg',dw_trae.getitemstring(j,'zona'))
				dw_export.setitem(i,'fecha_tra',dw_trae.getitemstring(j,'fing'))
				dw_export.setitem(i,'hora_tra',dw_trae.getitemstring(j,'hing'))
				dw_export.setitem(i,'cod_hab_ips',dw_trae.getitemstring(j,'codhabi'))
				dw_export.setitem(i,'cod_dep_ips',dw_trae.getitemstring(j,'depto_ips'))
				dw_export.setitem(i,'cod_mcpio_ips',dw_trae.getitemstring(j,'ciudad_ips'))
				if isnull(dw_trae.getitemstring(j,'folios')) then
					dw_export.setitem(i,'folios',1)
				else
					dw_export.setitem(i,'folios',dw_trae.getitemstring(j,'folios'))
				end if
			end if
	next
	nom_arch="furtran"+habi+dia+mes+anyo
	docname=nom_arch
	docname=tab_2.tp2_1.sle_dir.text+'\'+nom_arch+'.txt'
	nom_arch+='.txt'
	if dw_export.saveas(docname,CSV!,false)=-1 then
		if p_faltan then
			Messagebox("Error guardando furtran","No se puede guardar el archivo, revise el espacio o el estado del disco.~r~nLa radiciación generará aún así.")
		else
			Messagebox("Error guardando furtran","No se puede guardar el archivo, revise el espacio o el estado del disco.")
		end if
	else
		f_quita_espacio_rips(docname)
	end if
	real_name[1]=mid(nom_arch,1,len(nom_arch) -4)
	////////////////////// fin furtran
	end if
	
	
	
else
	messagebox('Atención','No hay registros para generar archivos')
end if
return 1	

end function

public function integer f_rips (boolean p_faltan, long p_nradica, string p_clug_rad, datawindow p_dw_conts, string p_decual, boolean p_cups, long p_cero, string p_por_lugar, string p_reserva);//string cual,param,nom_arch,emp,docname,realn[12],formato,log_txt ,cips//realn:real_name
//long j,i,filas,arch,num_af,num_ad,num_us,n_reg[7],num_radica=0,factus
//dec tot_evento,tot_capita
//datetime fecha_radica,fecha_ini,fecha_fin
//
//if p_decual='emp' then
//	if p_faltan and  p_nradica=0 then
//		fecha_ini=datetime(date(tab_2.tp2_1.tab_1.tp_1.em_1.text))
//		fecha_fin=datetime(date(tab_2.tp2_1.tab_1.tp_1.em_2.text))
//	else
//		fecha_ini=tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemdatetime(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),'fecha_inicial')
//		fecha_fin=tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemdatetime(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),'fecha_final')
//	end if
//else
//	fecha_ini=datetime(date(tab_2.tp2_2.em_3.text))
//	fecha_fin=datetime(date(tab_2.tp2_2.em_4.text))
//end if
//formato=""
//for j=1 to i_nro_dig -1
//	formato+="0"
//next
//formato+="#"
//string clug,cser
//clug=dw_lug.getitemstring(1,1)
//if rb_9.checked then 
//	cser='%'
//else
//	cser=dw_tipin.getitemstring(1,1)
//end if
//if p_faltan then
//	dw_trae.dataobject='dw_guarda_radica_rips'
//	dw_trae.settransobject(sqlca)
//	emp=p_dw_conts.getitemstring(1,"cemp")
//	fecha_radica=datetime(today())
//	if rb_7.checked then clug='%'
//	for j=1 to p_dw_conts.rowcount()
//		w_principal.SetMicroHelp ( 'Leyendo Datos Contrato '+string(j) )
//		if dw_trae.retrieve(emp,p_dw_conts.getitemstring(j,"ccontrato"),fecha_ini,fecha_fin,p_cero,j,clug,cser)=-1 then return -1
//		dw_trae.setfilter('num='+string(j)) //toca filtrarlo porque tiene return 2 en retrievestart
//		dw_trae.filter()
//		if dw_trae.rowcount()>0 then 
//			p_dw_conts.setitem(j,'valor_evento',round(dw_trae.getitemdecimal(1,'vtot_rad'),2))
//			p_dw_conts.setitem(j,'nro_factu',dw_trae.rowcount())
//		end if
//	next
//	dw_trae.setfilter('')
//	dw_trae.filter()
//	
//	if dw_trae.rowcount()=0 and p_reserva='0'  then 
//		if p_decual='lote' then //escribir en el log
//			filewrite(i_numarc,'				N O   H A Y   R E G I S T R O S   P A R A   G E N E R A R~r~n')
//		else
//			messagebox("Atención",'No hay registros para generar')
//		end if
//		return 0
//	end if
//	if p_nradica=0 then
//		num_radica=lf_trae_ndoc(p_decual)
//		if num_radica<0 then return -10//error grave
//		factus=p_dw_conts.getitemnumber(1,'t_factus')
//		tot_evento=round(p_dw_conts.getitemdecimal(1,'t_evento'),2)
//		tot_capita=round(p_dw_conts.getitemdecimal(1,'t_capita'),2)
//		INSERT INTO ripsradica ( num_radicacion,clugar, cemp , fecha_radica, fecha_inicial, fecha_final ,usuario,valor_capita,valor_evento,nro_factu,por_lugar,reserva) 
//		values (:num_radica,:clugar,:emp,:fecha_radica,:fecha_ini,:fecha_fin,:usuario,:tot_capita,:tot_evento,:factus,:p_por_lugar,:p_reserva);
//		if sqlca.sqlcode=-1 then
//			if p_decual='lote' then //escribir en el log
//				log_txt="Error insertando en Ripsradica"+sqlca.sqlerrtext
//				filewrite(i_numarc,log_txt)
//			else
//				messagebox("Error insertando en Ripsradica",sqlca.sqlerrtext)
//			end if
//			return -1
//		end if
//		for j=1 to p_dw_conts.rowcount()
//			p_dw_conts.setitem(j,'num_radicacion',num_radica)
//			p_dw_conts.setitem(j,'clugar',clugar)
//		next
//		w_principal.SetMicroHelp ( 'Insertando en RispRadicaDet' )
//		if p_dw_conts.update()=-1 then //no se escribe aqui en el log se hace en el dberror del dw
//			return -1
//		end if
//	else
//		num_radica= p_nradica
//	end if
//	if p_reserva='1' and p_nradica=0 then return num_radica
//
//	w_principal.SetMicroHelp ( 'Actualizando Factcab '+string(dw_trae.rowcount())+' regs.' )
//	for j=1 to dw_trae.rowcount()
//		dw_trae.setitem(j,'nradica',num_radica)
//		dw_trae.setitem(j,'clugar_rad',clugar)
//	next
//	w_principal.SetMicroHelp ( 'Guardando en Factcab' )
//	if dw_trae.update()=-1 then return -1
//	p_nradica=num_radica
//	p_clug_rad=clugar
//	if p_dw_conts.find('ctipo="3"',1,p_dw_conts.rowcount())>0 then
//		if lf_genera_act_final(p_nradica,p_clug_rad)=-1 then return -1
//	end if
//	commit;
//end if// fin los que faltan (nuevos)
//////////////////////////////////de aqui pa'lla es como si fueran radicaciones pasadas
//if p_dw_conts.getitemnumber(1,'forecat')=0 or isnull(p_dw_conts.getitemnumber(1,'forecat')) then //son los rips normales
//	for arch=1 to 7
//		choose case arch 
//			case 1
//				cual="Consulta"
//			case 2
//				cual="Procedimientos"
//			case 3
//				cual="Recien Nacido"
//			case 4
//				cual="Hospitalización"
//			case 5
//				cual="Medicamentos"
//			case 6
//				cual="Otros"
//			case 7
//				cual="Urgencias"
//		end choose
//		choose case cual
//			case "Consulta"  //archivo/empresa/contrato/fechas
//				dw_trae.dataobject="dr_rips_consulta_viejo"
//				dw_export.dataobject="dr_export_rips_consulta"
//				nom_arch="AC"
//			case "Procedimientos"
//				dw_trae.dataobject="dr_rips_procedimientos_viejo"
//				dw_export.dataobject="dr_export_rips_proc"
//				nom_arch="AP"
//			case "Urgencias"
//				dw_trae.dataobject="dr_rips_urg_viejo"
//				dw_export.dataobject="dr_export_rips_urg"
//				nom_arch="AU"
//			case "Hospitalización"
//				dw_trae.dataobject="dr_rips_hosp_viejo"
//				dw_export.dataobject="dr_export_rips_hosp"
//				nom_arch="AH"
//			case "Recien Nacido"
//				dw_trae.dataobject="dr_rips_rn_viejo"
//				dw_export.dataobject="dr_export_rips_rn"
//				nom_arch="AN"
//			case "Medicamentos"
//				dw_trae.dataobject="dr_rips_medica_viejo"
//				dw_export.dataobject="dr_export_rips_medica"
//				nom_arch="AM"
//			case "Otros"
//				dw_trae.dataobject="dr_rips_otros_viejo"
//				dw_export.dataobject="dr_export_rips_otros"
//				nom_arch="AT"
//		end choose
//		dw_trae.settransobject(sqlca)
//		w_principal.SetMicroHelp ( 'Leyendo Archivo '+cual )
//		dw_trae.reset()
//		if dw_trae.retrieve(p_nradica,p_clug_rad,p_por_lugar,cser)<>-1 then
//			dw_export.reset()
//			if dw_trae.rowcount()=0 then
//				if p_decual='emp' then
//					if tab_2.tp2_1.rb_names.checked then messagebox("Atención","No hay registros de "+cual+" para generar con estas condiciones")
//				else//escribir en el log
//					log_txt='~t~t~t'+nom_arch+': 0 registros (OK)'
//					filewrite(i_numarc,log_txt)
//				end if
//				n_reg[arch]=dw_trae.rowcount()
//			else
//				filas=dw_trae.rowcount()
//				n_reg[arch]=filas
//				for j=1 to filas
//					i=dw_export.insertrow(0)
//					choose case cual
//						case "Consulta"  //archivo/empresa/contrato/fechas (Parémetros de Entrada del DataWindow)
//							string ojo
//							ojo=dw_trae.getitemstring(j,"clugar_fac")
//							ojo=string(dw_trae.getitemnumber(j,1),formato)
//							if concatena_fac="1" then
//								dw_export.setitem(i,1,dw_trae.getitemstring(j,"clugar_fac")+string(dw_trae.getitemnumber(j,1),formato)) //factura
//							else
//								dw_export.setitem(i,1,string(dw_trae.getitemnumber(j,1))) //factura
//							end if
//							dw_export.setitem(i,2,dw_trae.getitemstring(j,'este_codigo')) //cod_ips
//							dw_export.setitem(i,3,dw_trae.getitemstring(j,3)) //tipo_doc
//							dw_export.setitem(i,4,dw_trae.getitemstring(j,4)) //documento
//							dw_export.setitem(i,5,string(dw_trae.getitemdatetime(j,5),"dd/mm/yyyy")) //fecha
//							dw_export.setitem(i,6,dw_trae.getitemstring(j,6)) //nro_autoriza
//							if p_cups then
//								dw_export.setitem(i,7,dw_trae.getitemstring(j,'proccups')) 
//							else
//								dw_export.setitem(i,7,dw_trae.getitemstring(j,7)) //cproced
//							end if
//							dw_export.setitem(i,8,dw_trae.getitemstring(j,8)) //finalidad consulta
//							dw_export.setitem(i,9,dw_trae.getitemstring(j,9)) //causa externa
//							dw_export.setitem(i,10,dw_trae.getitemstring(j,10)) //diag_prin
//							dw_export.setitem(i,11,dw_trae.getitemstring(j,11)) //diagrel1
//							dw_export.setitem(i,12,dw_trae.getitemstring(j,12)) //diagrel2
//							dw_export.setitem(i,13,dw_trae.getitemstring(j,13)) //diagrel3
//							dw_export.setitem(i,14,dw_trae.getitemstring(j,14)) //tipo_diag_prin
////							dw_export.setitem(i,15,string(dw_trae.getitemnumber(j,15),"#####0.00")) //vproced
//							dw_export.setitem(i,15,string(dw_trae.getitemnumber(j,15),"#####0")) //vproced
////							dw_export.setitem(i,16,string(dw_trae.getitemnumber(j,"cuota_modera"),"#####0.00")) //cuota moder							
//							dw_export.setitem(i,16,string(dw_trae.getitemnumber(j,"cuota_modera"),"#####0")) //cuota moder
////							dw_export.setitem(i,17,string(dw_trae.getitemnumber(j,16),"#####0.00")) //valor a pagar v_emp							
//							dw_export.setitem(i,17,string(dw_trae.getitemnumber(j,16),"#####0")) //valor a pagar v_emp
//						case "Procedimientos"
//							if concatena_fac="1" then
//								dw_export.setitem(i,1,dw_trae.getitemstring(j,"clugar_fac")+string(dw_trae.getitemnumber(j,1),formato)) //factura
//							else
//								dw_export.setitem(i,1,string(dw_trae.getitemnumber(j,1))) //factura
//							end if
//							dw_export.setitem(i,2,dw_trae.getitemstring(j,'este_codigo')) //cod_ips
//							dw_export.setitem(i,3,dw_trae.getitemstring(j,3)) //tipo_doc
//							dw_export.setitem(i,4,dw_trae.getitemstring(j,4)) //documento
//							dw_export.setitem(i,5,string(dw_trae.getitemdatetime(j,5),"dd/mm/yyyy")) //fecha
//							dw_export.setitem(i,6,dw_trae.getitemstring(j,6)) //nro_autoriza
//							if p_cups then
//								dw_export.setitem(i,7,dw_trae.getitemstring(j,'proccups'))
//							else
//								dw_export.setitem(i,7,dw_trae.getitemstring(j,7)) //cproced
//							end if
//							dw_export.setitem(i,8,dw_trae.getitemstring(j,8)) //ambito procedim
//							dw_export.setitem(i,9,dw_trae.getitemstring(j,9)) //finalidad procedim
//							dw_export.setitem(i,10,dw_trae.getitemstring(j,10)) //personal que atiende
//							dw_export.setitem(i,11,dw_trae.getitemstring(j,11)) //diagprin
//							dw_export.setitem(i,12,dw_trae.getitemstring(j,12)) //diagrel1
//							dw_export.setitem(i,13,dw_trae.getitemstring(j,13)) //diag complicación
//							dw_export.setitem(i,14,dw_trae.getitemstring(j,14)) //forma tipo acto quir
////							dw_export.setitem(i,15,string(dw_trae.getitemnumber(j,15),"#####0.00")) //vproced
//							dw_export.setitem(i,15,string(dw_trae.getitemnumber(j,15),"#####0")) //vproced
//						case "Urgencias"
//							if concatena_fac="1" then
//								dw_export.setitem(i,1,dw_trae.getitemstring(j,"clugar_fac")+string(dw_trae.getitemnumber(j,1),formato)) //factura
//							else
//								dw_export.setitem(i,1,string(dw_trae.getitemnumber(j,1))) //factura
//							end if
//							dw_export.setitem(i,2,dw_trae.getitemstring(j,'este_codigo'))
//							dw_export.setitem(i,3,dw_trae.getitemstring(j,3))
//							dw_export.setitem(i,4,dw_trae.getitemstring(j,4))
//							dw_export.setitem(i,5,string(dw_trae.getitemdatetime(j,5),"dd/mm/yyyy"))
//							dw_export.setitem(i,6,string(dw_trae.getitemdatetime(j,6),"HH:mm"))
//							dw_export.setitem(i,7,left(dw_trae.getitemstring(j,7),15))//autoriza
//							dw_export.setitem(i,8,dw_trae.getitemstring(j,8))//causaext
//							dw_export.setitem(i,9,dw_trae.getitemstring(j,25))//diagsal
//							dw_export.setitem(i,10,dw_trae.getitemstring(j,26))//drel1
//							dw_export.setitem(i,11,dw_trae.getitemstring(j,27))//drel2
//							dw_export.setitem(i,12,dw_trae.getitemstring(j,28))//drel3
//							dw_export.setitem(i,13,dw_trae.getitemstring(j,13))//destino
//							dw_export.setitem(i,14,dw_trae.getitemstring(j,14))//estado sal
//							dw_export.setitem(i,15,dw_trae.getitemstring(j,29))//causamuerte
//							dw_export.setitem(i,16,string(dw_trae.getitemdatetime(j,16),"dd/mm/yyyy"))
//							dw_export.setitem(i,17,string(dw_trae.getitemdatetime(j,17),"HH:mm"))
//						case "Hospitalización"
//							if concatena_fac="1" then
//								dw_export.setitem(i,1,dw_trae.getitemstring(j,"clugar_fac")+string(dw_trae.getitemnumber(j,1),formato)) //factura
//							else
//								dw_export.setitem(i,1,string(dw_trae.getitemnumber(j,1))) //factura
//							end if
//							dw_export.setitem(i,2,dw_trae.getitemstring(j,'este_codigo'))//cips
//							dw_export.setitem(i,3,dw_trae.getitemstring(j,3))//tdoc
//							dw_export.setitem(i,4,dw_trae.getitemstring(j,4))//docu
//							dw_export.setitem(i,5,dw_trae.getitemstring(j,5))//via ing
//							dw_export.setitem(i,6,string(dw_trae.getitemdatetime(j,6),"dd/mm/yyyy"))
//							dw_export.setitem(i,7,string(dw_trae.getitemdatetime(j,7),"HH:mm"))
//							dw_export.setitem(i,8,left(dw_trae.getitemstring(j,8),15))//autoriza
//							dw_export.setitem(i,9,dw_trae.getitemstring(j,9))//causaext
//							dw_export.setitem(i,10,dw_trae.getitemstring(j,28))//diag prin ing
//							dw_export.setitem(i,11,dw_trae.getitemstring(j,29))//diag prin egre
//							dw_export.setitem(i,12,dw_trae.getitemstring(j,30))//diag rel1
//							dw_export.setitem(i,13,dw_trae.getitemstring(j,31))//diag rel2
//							dw_export.setitem(i,14,dw_trae.getitemstring(j,32))//diag rel3
//							dw_export.setitem(i,15,dw_trae.getitemstring(j,33))//diag compl
//							dw_export.setitem(i,16,dw_trae.getitemstring(j,16))//estado sal
//							dw_export.setitem(i,17,dw_trae.getitemstring(j,34))//diag muerte
//							dw_export.setitem(i,18,string(dw_trae.getitemdatetime(j,18),"dd/mm/yyyy"))
//							dw_export.setitem(i,19,string(dw_trae.getitemdatetime(j,19),"HH:mm"))
//							
//						case "Recien Nacido"
//							if concatena_fac="1" then
//								dw_export.setitem(i,1,dw_trae.getitemstring(j,"clugar_fac")+string(dw_trae.getitemnumber(j,1),formato)) //factura
//							else
//								dw_export.setitem(i,1,string(dw_trae.getitemnumber(j,1))) //factura
//							end if
//							dw_export.setitem(i,2,dw_trae.getitemstring(j,'este_codigo'))//cips
//							dw_export.setitem(i,3,dw_trae.getitemstring(j,3))//tdoc
//							dw_export.setitem(i,4,dw_trae.getitemstring(j,4))//docu
//							dw_export.setitem(i,5,string(dw_trae.getitemdatetime(j,5),"dd/mm/yyyy"))//fecha_nac
//							dw_export.setitem(i,6,string(dw_trae.getitemdatetime(j,5),"HH:mm"))//horanac
//							dw_export.setitem(i,7,string(dw_trae.getitemnumber(j,6)))//edad gesta
//							dw_export.setitem(i,8,dw_trae.getitemstring(j,7))//control prenatal
//							dw_export.setitem(i,9,dw_trae.getitemstring(j,8))//sexo
//							dw_export.setitem(i,10,string(dw_trae.getitemnumber(j,9)))//peso
//							dw_export.setitem(i,11,dw_trae.getitemstring(j,15))//diag rn
//							dw_export.setitem(i,12,dw_trae.getitemstring(j,16))//diag muerte
//							dw_export.setitem(i,13,string(dw_trae.getitemdatetime(j,12),"dd/mm/yyyy"))
//							dw_export.setitem(i,14,string(dw_trae.getitemdatetime(j,12),"HH:mm"))
//							
//						case "Medicamentos"
//							if concatena_fac="1" then
//								dw_export.setitem(i,1,dw_trae.getitemstring(j,"clugar")+string(dw_trae.getitemnumber(j,1),formato)) //factura
//							else
//								dw_export.setitem(i,1,string(dw_trae.getitemnumber(j,1))) //factura
//							end if
//							dw_export.setitem(i,2,dw_trae.getitemstring(j,'este_codigo'))//cips
//							dw_export.setitem(i,3,dw_trae.getitemstring(j,3))//tdoc
//							dw_export.setitem(i,4,dw_trae.getitemstring(j,4))//docu
//							dw_export.setitem(i,5,left(dw_trae.getitemstring(j,5),15))//autoriza
//							dw_export.setitem(i,6,dw_trae.getitemstring(j,"codigo_unif"))//cmedica
//							dw_export.setitem(i,7,dw_trae.getitemstring(j,7))//tipo med
//							dw_export.setitem(i,8,left(dw_trae.getitemstring(j,8),30))//nombre med
//							dw_export.setitem(i,9,left(dw_trae.getitemstring(j,"formafarma"),20))//forma far
//							dw_export.setitem(i,10,left(dw_trae.getitemstring(j,"concentracion"),20))//concentra
//							dw_export.setitem(i,11,left(dw_trae.getitemstring(j,"unidadmed"),20))//umed
//							dw_export.setitem(i,12,string(dw_trae.getitemnumber(j,12)))//cant
////							dw_export.setitem(i,13,string(dw_trae.getitemnumber(j,13),"#####0.00"))//vunit
//							dw_export.setitem(i,13,string(dw_trae.getitemnumber(j,13),"#####0"))//vunit
////							dw_export.setitem(i,14,string(dw_trae.getitemnumber(j,14),"#####0.00"))//vtotal
//							dw_export.setitem(i,14,string(dw_trae.getitemnumber(j,14),"#####0"))//vtotal
//						case "Otros"
//							if concatena_fac="1" then
//								dw_export.setitem(i,1,dw_trae.getitemstring(j,"clugar")+string(dw_trae.getitemnumber(j,1),formato)) //factura
//							else
//								dw_export.setitem(i,1,string(dw_trae.getitemnumber(j,1))) //factura
//							end if
//							dw_export.setitem(i,2,dw_trae.getitemstring(j,'este_codigo'))//cips
//							dw_export.setitem(i,3,dw_trae.getitemstring(j,3))//tdoc
//							dw_export.setitem(i,4,dw_trae.getitemstring(j,4))//docu
//							dw_export.setitem(i,5,left(dw_trae.getitemstring(j,5),15))//autoriza
//							dw_export.setitem(i,6,dw_trae.getitemstring(j,6))//tipo_serv
//							if p_cups then
//								dw_export.setitem(i,7,dw_trae.getitemstring(j,'proccups'))
//							else
//								dw_export.setitem(i,7,dw_trae.getitemstring(j,7))//codigo
//							end if
//							dw_export.setitem(i,8,left(dw_trae.getitemstring(j,8),60))//nombre
//							dw_export.setitem(i,9,string(dw_trae.getitemnumber(j,9)))//cantidad
////							dw_export.setitem(i,10,string(dw_trae.getitemnumber(j,10),"#####0.00"))//vuni
//							dw_export.setitem(i,10,string(dw_trae.getitemnumber(j,10),"#####0"))//vuni
////							dw_export.setitem(i,11,string(dw_trae.getitemnumber(j,11),"#####0.00"))//vtotal
//							dw_export.setitem(i,11,string(dw_trae.getitemnumber(j,11),"#####0"))//vtotal
//					end choose
//					w_principal.SetMicroHelp ( 'Copiando '+cual+'(reg. '+string(j)+' de '+string(filas)+')' )
//					if p_decual='emp' then tab_2.tp2_1.t1.tp1.barra.position= 25 + Int((j * 75)/filas)
//				next
//				nom_arch+=string(p_nradica)
//				docname=nom_arch
//				w_principal.SetMicroHelp ( 'Exportando Archivo '+cual )
//				if p_decual='emp' then
//					if tab_2.tp2_1.rb_names.checked then//preguntar una a uno
//						//docname es el largo y nom_arc el solo archivito
//						if GetFileSaveName("Archivo de "+cual+" ("+nom_arch+")",docname, nom_arch, "txt", "Archivos de Texto (*.txt),*.txt" )<>1 then
//							if p_faltan then messagebox("Atención",'De todas formas fue generada la radicación Nro: '+string(p_nradica))
//							return 0
//						end if
//					else//mandarlos todos al directorio
//						docname=tab_2.tp2_1.sle_dir.text+'\'+nom_arch+'.txt'
//						nom_arch+='.txt'
//					end if
//				else //de lote
//					docname=tab_2.tp2_2.sle_sale.text+'\'+nom_arch+'.txt'
//					nom_arch+='.txt'
//				end if
//				if dw_export.saveas(docname,CSV!,false)=-1 then
//					if p_decual='emp' then 
//						Messagebox("Error guardando archivo "+cual,"No se puede guardar el archivo, revise el espacio o el estado del disco")
//					else
//						log_txt="Error guardando archivo "+cual+" .No se puede guardar el archivo, revise el espacio o el estado del disco. El proceso continua"
//						filewrite(i_numarc,log_txt)
//					end if
//				else
//					w_principal.SetMicroHelp ( 'Quitando espacio a '+cual )
//					f_quita_espacio_rips(docname)
//					if p_decual='lote' then//escribir enm el log
//						log_txt='~t~t~t'+nom_arch+' :'+string(dw_export.rowcount())+' Registro(s) (OK)'
//						filewrite(i_numarc,log_txt)
//					end if
//				end if
//				realn[arch]=mid(nom_arch,1,len(nom_arch) -4)
//				tab_2.tp2_1.t1.tp1.barra.position=0
//			end if
//		end if
//	next
//	////// 2
//	w_principal.SetMicroHelp ( 'Leyendo AF' )
//	dw_trae.dataobject="dr_rips_af_transacc_viejo"
//	dw_trae.settransobject(sqlca)
//	dw_trae.reset()
//	dw_trae.retrieve(p_nradica,p_clug_rad,p_por_lugar)
//	dw_export.dataobject="dr_export_rips_af_transac"
//	filas=dw_trae.rowcount()
//	dec comis
//	for j=1 to filas
//		i=dw_export.insertrow(0)
//		dw_export.setitem(i,1,dw_trae.getitemstring(j,"este_codigo"))
//		dw_export.setitem(i,2,left(dw_trae.getitemstring(j,"ips_nombre"),60))
//		dw_export.setitem(i,3,dw_trae.getitemstring(j,"tipo_doc"))
//		dw_export.setitem(i,4,dw_trae.getitemstring(j,"documento"))
//		if concatena_fac="1" then
//			dw_export.setitem(i,5,dw_trae.getitemstring(j,"clugar")+string(dw_trae.getitemnumber(j,"nfact"),formato)) //factura
//		else
//			dw_export.setitem(i,5,string(dw_trae.getitemnumber(j,"nfact"))) //factura
//		end if
//		dw_export.setitem(i,6,string(dw_trae.getitemdatetime(j,"fecha"),"dd/mm/yyyy"))
//		dw_export.setitem(i,7,string(fecha_ini,'dd/mm/yyyy'))
//		dw_export.setitem(i,8,string(fecha_fin,'dd/mm/yyyy'))
//		dw_export.setitem(i,9,dw_trae.getitemstring(j,"codsuper"))
//		dw_export.setitem(i,10,left(dw_trae.getitemstring(j,"desemp"),30))
//		dw_export.setitem(i,11,dw_trae.getitemstring(j,"nro_contrato"))
//		dw_export.setitem(i,12,dw_trae.getitemstring(j,"plan"))
//		dw_export.setitem(i,13,dw_trae.getitemstring(j,"npoliza"))
////		dw_export.setitem(i,14,string(dw_trae.getitemnumber(j,"vtcopago"),"#####0.00"))
//		dw_export.setitem(i,14,string(dw_trae.getitemnumber(j,"vtcopago"),"#####0"))
//		comis=dw_trae.getitemnumber(j,"vtcomision") 
//		if isnull(comis) then comis=0
////		dw_export.setitem(i,15,string(comis,"#####0.00"))
//		dw_export.setitem(i,15,string(comis,"#####0"))
////		dw_export.setitem(i,16,string(dw_trae.getitemnumber(j,"vtdescuentos"),"#####0.00"))
//		dw_export.setitem(i,16,string(dw_trae.getitemnumber(j,"vtdescuentos"),"#####0"))		
////		dw_export.setitem(i,17,string(dw_trae.getitemnumber(j,"vtemp"),"#####0.00"))
//		dw_export.setitem(i,17,string(dw_trae.getitemnumber(j,"vtemp"),"#####0"))		
//		w_principal.SetMicroHelp ( 'Copiando AF reg. '+string(j)+' de '+string(filas) )
//	next
//	num_af=dw_export.rowcount()
//	nom_arch="AF"+string(p_nradica)
//	docname=nom_arch
//	if dw_export.rowcount()>0 then
//		w_principal.SetMicroHelp ( 'Exportando AF' )
//		if p_decual='emp' then
//			if tab_2.tp2_1.rb_names.checked then//preguntar una a uno
//				//docname es el largo y nom_arc el solo archivito
//				if GetFileSaveName("Archivo de Transacciones ("+nom_arch+")",docname, nom_arch, "txt", "Archivos de Texto (*.txt),*.txt" )<>1 then 
//					if p_faltan then messagebox("Atención",'Aún así se generó la radicación Nro:'+string(p_nradica))
//					return 0
//				end if
//			else//mandarlos todos al directorio
//				docname=tab_2.tp2_1.sle_dir.text+'\'+nom_arch+'.txt'
//				nom_arch+='.txt'
//			end if
//		else
//			docname=tab_2.tp2_2.sle_sale.text+'\'+nom_arch+'.txt'
//			nom_arch+='.txt'
//		end if
//		if dw_export.saveas(docname,CSV!,false)=-1 then
//			if p_decual='emp' then
//				if p_faltan then
//					Messagebox("Error guardando archivo de Transacciones","No se puede guardar el archivo, revise el espacio o el estado del disco.~r~nLa radicación se generará aún así.")
//				else
//					Messagebox("Error guardando archivo de Transacciones","No se puede guardar el archivo, revise el espacio o el estado del disco.")
//				end if
//			else
//				log_txt="Error guardando archivo de Transacciones revise el espacio o el estado del disco.La radicación se generará aún así."
//				filewrite(i_numarc,log_txt)
//			end if	
//			tab_2.tp2_1.t1.tp1.barra.position=0
//		else
//			f_quita_espacio_rips(docname)
//			if p_decual='lote' then
//				log_txt='~t~t~tAF'+string(p_nradica)+'.txt :'+string(dw_export.rowcount())+' Registro(s) (OK)'
//				filewrite(i_numarc,log_txt)
//			end if
//		end if
//		realn[8]=mid(nom_arch,1,len(nom_arch) -4)
//	end if
//	///// 2
//	///// 3
//	dw_trae.dataobject="dr_rips_ad_descip_agrup"
//	dw_trae.settransobject(sqlca)
//	w_principal.SetMicroHelp ( 'Leyendo AD' )
//	dw_trae.reset()
//	if rb_7.checked then 
//		select c_supersalud into :cips from ips where c_ips='01'; //ahi solo puede estar este código
//	else
//		select c_supersalud into :cips from lugar where codlugar=:clug; //ahi solo puede estar este código
//	end if
//	
//	dw_trae.retrieve(p_nradica,p_clug_rad,cips)
//	dw_export.dataobject="dr_export_rips_ad_descrip"
//	dw_export.reset()
//	nom_arch="AD"+string(p_nradica)
//	docname=nom_arch
//	filas=dw_trae.rowcount()
//	for j=1 to filas
//		i=dw_export.insertrow(0)
//		if concatena_fac="1" then
//			dw_export.setitem(i,1,dw_trae.getitemstring(j,"clugar")+string(dw_trae.getitemnumber(j,1),formato)) //factura
//		else
//			dw_export.setitem(i,1,string(dw_trae.getitemnumber(j,1))) //factura
//		end if
//		dw_export.setitem(i,2,dw_trae.getitemstring(j,2))
//		dw_export.setitem(i,3,dw_trae.getitemstring(j,3))
//		dw_export.setitem(i,4,string(dw_trae.getitemnumber(j,4)))
//		dw_export.setitem(i,5,dw_trae.getitemstring(j,5))
////		dw_export.setitem(i,6,string(dw_trae.getitemnumber(j,6),"######0.00"))
//		dw_export.setitem(i,6,string(dw_trae.getitemnumber(j,6),"######0"))
//		w_principal.SetMicroHelp ( 'Copiando AD reg. '+string(j)+' de '+string(filas) )
//	next
//	if dw_export.rowcount()>0 then
//		w_principal.SetMicroHelp ( 'Exportando AD' )
//		if p_decual='emp' then
//			if tab_2.tp2_1.rb_names.checked then//preguntar una a uno
//				//docname es el largo y nom_arc el solo archivito
//				if GetFileSaveName("Archivo de Descripción Agrupada ("+nom_arch+")",docname, nom_arch, "txt", "Archivos de Texto (*.txt),*.txt" )<>1 then 
//					if p_faltan then messagebox("Atención",'Aún así se generó la radicación Nro:'+string(p_nradica))
//					return 0
//				end if
//			else//mandarlos todos al directorio
//				docname=tab_2.tp2_1.sle_dir.text+'\'+nom_arch+'.txt'
//				nom_arch+='.txt'
//			end if
//		else
//			docname=tab_2.tp2_2.sle_sale.text+'\'+nom_arch+'.txt'
//			nom_arch+='.txt'
//		end if
//		if dw_export.saveas(docname,CSV!,false)=-1 then
//			if p_decual='emp' then
//				if p_faltan then
//					Messagebox("Error guardando archivo de Descripción Agrupada","No se puede guardar el archivo, revise el espacio o el estado del disco.~r~nLa radicación generará aún así.")
//				else
//					Messagebox("Error guardando archivo de Descripción Agrupada","No se puede guardar el archivo, revise el espacio o el estado del disco.")
//				end if
//			else
//				log_txt="Error guardando archivo de Descripción Agrupada revise el espacio o el estado del disco.La radicación se generará aún así."
//				filewrite(i_numarc,log_txt)
//			end if
//		else
//			f_quita_espacio_rips(docname)
//			if p_decual='lote' then
//				log_txt='~t~t~tAD'+string(p_nradica)+'.txt :'+string(dw_export.rowcount())+' Registro(s) (OK)'
//				filewrite(i_numarc,log_txt)
//			end if
//		end if
//		realn[9]=mid(nom_arch,1,len(nom_arch) -4)
//	end if
//	
//	num_ad=dw_trae.rowcount()
//	///// 3
//	///// 4
//	dw_trae.dataobject="dr_rips_us_usuarios"
//	dw_export.dataobject="dr_export_rips_us"
//	w_principal.SetMicroHelp ( 'Leyendo US' )
//	dw_trae.settransobject(sqlca)
//	dw_trae.reset()
//	dw_trae.retrieve(p_nradica,fecha_fin,p_clug_rad)
//	nom_arch="US"+string(p_nradica)
//	docname=nom_arch
//	dw_export.reset()
//	filas=dw_trae.rowcount()
//	for j=1 to filas
//		i=dw_export.insertrow(0)
//		dw_export.setitem(i,1,dw_trae.getitemstring(j,"tipodoc"))
//		dw_export.setitem(i,2,dw_trae.getitemstring(j,"documento"))
//		dw_export.setitem(i,3,dw_trae.getitemstring(j,"codsuper"))
//		dw_export.setitem(i,4,dw_trae.getitemstring(j,"tu"))
//		dw_export.setitem(i,5,dw_trae.getitemstring(j,"apellido1"))
//		dw_export.setitem(i,6,dw_trae.getitemstring(j,"apellido2"))
//		dw_export.setitem(i,7,dw_trae.getitemstring(j,"nombre1"))
//		dw_export.setitem(i,8,dw_trae.getitemstring(j,"nombre2"))
//		dw_export.setitem(i,9,string(dw_trae.getitemnumber(j,"edad")))
//		dw_export.setitem(i,10,dw_trae.getitemstring(j,"u_med"))
//		dw_export.setitem(i,11,dw_trae.getitemstring(j,"sexo"))
//		dw_export.setitem(i,12,dw_trae.getitemstring(j,"cdepto"))
//		dw_export.setitem(i,13,dw_trae.getitemstring(j,"cciudad"))
//		dw_export.setitem(i,14,dw_trae.getitemstring(j,"zonar"))
//		w_principal.SetMicroHelp ( 'Copiando US reg. '+string(j) + ' de '+string(filas))
//	next
//	num_us=dw_export.rowcount()
//	if dw_export.rowcount()>0 then
//		w_principal.SetMicroHelp ( 'Exportando US' )
//		if p_decual='emp' then
//			if tab_2.tp2_1.rb_names.checked then//preguntar una a uno
//				//docname es el largo y nom_arc el solo archivito
//				if GetFileSaveName("Archivo de Usuarios ("+nom_arch+")",docname, nom_arch, "txt", "Archivos de Texto (*.txt),*.txt" )<>1 then
//					if p_faltan then messagebox("Atención",'Aún así se generó la radicación Nro:'+string(p_nradica))
//					return 0
//				end if
//			else//mandarlos todos al directorio
//				docname=tab_2.tp2_1.sle_dir.text+'\'+nom_arch+'.txt'
//				nom_arch+='.txt'
//			end if
//		else
//			docname=tab_2.tp2_2.sle_sale.text+'\'+nom_arch+'.txt'
//			nom_arch+='.txt'
//		end if
//		if dw_export.saveas(docname,CSV!,false)=-1 then
//			if p_decual='emp' then 
//				if p_faltan then
//					Messagebox("Error guardando archivo de usuarios","No se puede guardar el archivo, revise el espacio o el estado del disco.~r~nLa radiciación generará aún así.")
//				else
//					Messagebox("Error guardando archivo de usuarios","No se puede guardar el archivo, revise el espacio o el estado del disco.")
//				end if
//			else
//				log_txt="Error guardando archivo de usuarios revise el espacio o el estado del disco.La radicación se generará aún así."
//				filewrite(i_numarc,log_txt)
//			end if
//		else
//			f_quita_espacio_rips(docname)
//			if p_decual='lote' then
//				log_txt='~t~t~tUS'+string(p_nradica)+'.txt :'+string(dw_export.rowcount())+' Registro(s) (OK)'
//				filewrite(i_numarc,log_txt)
//			end if
//		end if
//		realn[10]=mid(nom_arch,1,len(nom_arch) -4)
//	end if
//	
//	////// 1
//	//dw_trae.dataobject="dr_rips_control"
//	//dw_trae.settransobject(sqlca)
//	//dw_trae.retrieve(p_nradica,p_clug_rad)
//	dw_export.dataobject="dr_export_rips_ac"
//	dw_export.reset()
//	string fecha_rad
//	w_principal.SetMicroHelp ( 'Copiando CT' )
//	if p_faltan then 
//		fecha_rad=string(today(),"dd/mm/yyyy")
//	else
//		fecha_rad=string(tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemdatetime(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"fecha_radica"),"dd/mm/yyyy")
//	end if
//	if rb_7.checked then 
//		select c_supersalud into :cips from ips where c_ips='01'; //ahi solo puede estar este código
//	else
//		select c_supersalud into :cips from lugar where codlugar=:clug; //ahi solo puede estar este código
//	end if
//	if num_ad>0 then
//		dw_export.insertrow(1)
//		dw_export.setitem(1,1,cips)
//		dw_export.setitem(1,2,fecha_rad)
//		dw_export.setitem(1,3,realn[9]) //ad
//		dw_export.setitem(1,4,string(num_ad))
//	end if
//	if num_af>0 then
//		dw_export.insertrow(1)
//		dw_export.setitem(1,1,cips)
//		dw_export.setitem(1,2,fecha_rad)
//		dw_export.setitem(1,3,realn[8]) //af
//		dw_export.setitem(1,4,string(num_af))
//	end if
//	if num_us>0 then
//		dw_export.insertrow(1)
//		dw_export.setitem(1,1,cips)
//		dw_export.setitem(1,2,fecha_rad)
//		dw_export.setitem(1,3,realn[10])//us
//		dw_export.setitem(1,4,string(num_us))
//	end if
//	
//	
//	//for j=1 to dw_trae.rowcount()
//	//	i=dw_export.insertrow(0)
//	//	dw_export.setitem(i,1,dw_trae.getitemstring(j,"c_supersalud"))
//	//	dw_export.setitem(i,2,string(dw_trae.getitemdatetime(j,"fecha_radica"),"dd/mm/yyyy"))
//	//	choose case dw_trae.getitemstring(j,"archivo")
//	//		case "AC"
//	//			dw_export.setitem(i,3,realn[1])
//	//		case "AP"
//	//			dw_export.setitem(i,3,realn[2])
//	//	end choose
//	//	dw_export.setitem(i,4,string(dw_trae.getitemnumber(j,"cuantos")))
//	//next
//	for j=1 to 7
//		if n_reg[j]>0 then
//			i=dw_export.insertrow(0)
//			dw_export.setitem(i,1,cips)
//			dw_export.setitem(i,2,fecha_rad)
//			dw_export.setitem(i,3,realn[j])
//			dw_export.setitem(i,4,string(n_reg[j]))
//		end if
//	next
//	w_principal.SetMicroHelp ( 'Exportando CT' )
//	nom_arch="CT"+string(p_nradica)
//	docname=nom_arch
//	if dw_export.rowcount()>0 then
//		if p_decual='emp' then
//			if tab_2.tp2_1.rb_names.checked then//preguntar una a uno
//				//docname es el largo y nom_arc el solo archivito
//				if GetFileSaveName("Archivo de Control ("+nom_arch+")",docname, nom_arch, "txt", "Archivos de Texto (*.txt),*.txt" )<>1 then 
//					if p_faltan then messagebox("Atención",'Aún así se generó la radicación Nro:'+string(p_nradica))
//					return 0
//				end if
//			else//mandarlos todos al directorio
//				docname=tab_2.tp2_1.sle_dir.text+'\'+nom_arch+'.txt'
//				nom_arch+='.txt'
//			end if
//		else
//			docname=tab_2.tp2_2.sle_sale.text+'\'+nom_arch+'.txt'
//			nom_arch+='.txt'
//		end if
//		if dw_export.saveas(docname,CSV!,false)=-1 then
//			if p_decual='emp' then
//				if p_faltan then
//					Messagebox("Error guardando archivo","No se puede guardar el archivo, revise el espacio o el estado del disco.~r~nLa radicación fue genarada aún así.")
//				else
//					Messagebox("Error guardando archivo","No se puede guardar el archivo, revise el espacio o el estado del disco.")
//				end if
//			else
//				log_txt="Error guardando archivo de Control revise el espacio o el estado del disco.La radicación se generará aún así."
//				filewrite(i_numarc,log_txt)
//			end if
//		else
//			f_quita_espacio_rips(docname)
//			if p_decual='lote' then
//				log_txt='~t~t~tCT'+string(p_nradica)+'.txt :'+string(dw_export.rowcount())+' Registro(s) (OK)'
//				filewrite(i_numarc,log_txt)
//			end if
//		end if
//	end if
//	if p_decual='lote' and p_nradica>0  then
//		log_txt='NRO RADICACIÓN: '+string(p_nradica)+'~r~n'
//		filewrite(i_numarc,log_txt)
//	end if
//	////// 1
//else //son los de forecat
//	//genera_forecat(p_nradica,p_clug_rad,fecha_fin,p_faltan)
//	genera_furips(p_nradica,p_clug_rad,fecha_radica,p_faltan)
//end if
//w_principal.SetMicroHelp ( 'Gestión Clínica Integrada' )
//if p_reserva='1' and p_nradica<>0 then
//	UPDATE ripsradica SET ripsradica.reserva = '0'
//	WHERE (((ripsradica.num_radicacion)=:p_nradica) AND ((ripsradica.clugar)=:p_clug_rad));
//	if sqlca.sqlcode=-1 then
//		messagebox("Error Actualizando en Ripsradica",sqlca.sqlerrtext)
//		return -1
//	end if
//end if
return p_nradica
end function

on w_pedt.create
this.st_8=create st_8
this.st_21=create st_21
this.dw_getar=create dw_getar
this.dw_temp=create dw_temp
this.dw_det_lote=create dw_det_lote
this.dw_export=create dw_export
this.dw_trae=create dw_trae
this.tab_2=create tab_2
this.Control[]={this.st_8,&
this.st_21,&
this.dw_getar,&
this.dw_temp,&
this.dw_det_lote,&
this.dw_export,&
this.dw_trae,&
this.tab_2}
end on

on w_pedt.destroy
destroy(this.st_8)
destroy(this.st_21)
destroy(this.dw_getar)
destroy(this.dw_temp)
destroy(this.dw_det_lote)
destroy(this.dw_export)
destroy(this.dw_trae)
destroy(this.tab_2)
end on

event open;//STRING NRO
//RegistryGet ("HKEY_LOCAL_MACHINE\software\GCI", "CONCATENA_FACTURA", Regstring!, CONCATENA_FAC )
SELECT cadena into :CONCATENA_FAC
FROM parametros_gen
WHERE (((codigo_para)=13));
if sqlca.sqlnrows=0 then
	messagebox('Atencíon','No hay parametro 13')
	return 
end if

//RegistryGet ("HKEY_LOCAL_MACHINE\software\GCI", "NRODIGITOS", Regstring!, NRO )
SELECT entero into :i_NRO_DIG
FROM parametros_gen
WHERE (((codigo_para)=14));
if sqlca.sqlnrows=0 then
	messagebox('Atencíon','No hay parametro 14')
	return 
end if


//i_NRO_DIG=long(NRO)
w_principal.ArrangeSheets ( layer!)
tab_2.tp2_1.tab_1.tp_1.em_anyo.text=String(Now(), "yyyy")
end event

type st_8 from statictext within w_pedt
integer x = 197
integer y = 500
integer width = 233
integer height = 56
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Año"
boolean focusrectangle = false
end type

type st_21 from statictext within w_pedt
integer x = 457
integer y = 500
integer width = 233
integer height = 48
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Trimestre"
boolean focusrectangle = false
end type

type dw_getar from datawindow within w_pedt
boolean visible = false
integer x = 3639
integer y = 324
integer width = 69
integer height = 68
integer taborder = 100
string title = "none"
string dataobject = "dw_act_getareo"
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event dberror; if i_decual='lote' then 
	filewrite(i_numarc,sqlerrtext)
	return 1 //para que no muestre el error en pantalla
end if
end event

event constructor;settransobject(sqlca)
end event

type dw_temp from datawindow within w_pedt
string tag = "para armar los de actividad final"
boolean visible = false
integer x = 3648
integer y = 432
integer width = 59
integer height = 68
integer taborder = 20
string title = "none"
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event dberror; if i_decual='lote' then 
	filewrite(i_numarc,sqlerrtext)
	return 1 //para que no muestre el error en pantalla
end if
end event

type dw_det_lote from datawindow within w_pedt
boolean visible = false
integer x = 3625
integer y = 512
integer width = 87
integer height = 68
integer taborder = 90
boolean enabled = false
string title = "none"
string dataobject = "dw_contratos_pa_rias"
boolean resizable = true
boolean livescroll = true
end type

event dberror;filewrite(i_numarc,sqlerrtext)
return 1 //para que no muestre el error en pantalla
end event

event constructor;settransobject(sqlca)
end event

type dw_export from datawindow within w_pedt
boolean visible = false
integer x = 3634
integer y = 216
integer width = 82
integer height = 68
boolean bringtotop = true
boolean enabled = false
string title = "none"
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

type dw_trae from datawindow within w_pedt
boolean visible = false
integer x = 3630
integer y = 124
integer width = 96
integer height = 72
boolean bringtotop = true
boolean enabled = false
string title = "none"
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event retrievestart;return 2
end event

event dberror; if i_decual='lote' then 
	filewrite(i_numarc,sqlerrtext)
	return 1 //para que no muestre el error en pantalla
else
	rollback;
end if
end event

type tab_2 from tab within w_pedt
event create ( )
event destroy ( )
integer x = 9
integer y = 28
integer width = 3589
integer height = 1964
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 67108864
boolean fixedwidth = true
boolean raggedright = true
boolean focusonbuttondown = true
boolean powertips = true
alignment alignment = center!
integer selectedtab = 1
tp2_1 tp2_1
tp2_2 tp2_2
end type

on tab_2.create
this.tp2_1=create tp2_1
this.tp2_2=create tp2_2
this.Control[]={this.tp2_1,&
this.tp2_2}
end on

on tab_2.destroy
destroy(this.tp2_1)
destroy(this.tp2_2)
end on

type tp2_1 from userobject within tab_2
event create ( )
event destroy ( )
integer x = 18
integer y = 112
integer width = 3552
integer height = 1836
long backcolor = 67108864
string text = "Por Empresa"
long tabtextcolor = 33554432
string picturename = "guardar_como.ico"
long picturemaskcolor = 536870912
string powertiptext = "Generar RIPS por Empresa"
t1 t1
tab_1 tab_1
rb_defecto rb_defecto
sle_dir sle_dir
cb_dir cb_dir
end type

on tp2_1.create
this.t1=create t1
this.tab_1=create tab_1
this.rb_defecto=create rb_defecto
this.sle_dir=create sle_dir
this.cb_dir=create cb_dir
this.Control[]={this.t1,&
this.tab_1,&
this.rb_defecto,&
this.sle_dir,&
this.cb_dir}
end on

on tp2_1.destroy
destroy(this.t1)
destroy(this.tab_1)
destroy(this.rb_defecto)
destroy(this.sle_dir)
destroy(this.cb_dir)
end on

type t1 from tab within tp2_1
event create ( )
event destroy ( )
integer y = 560
integer width = 3547
integer height = 1272
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 67108864
boolean fixedwidth = true
boolean raggedright = true
boolean focusonbuttondown = true
alignment alignment = center!
integer selectedtab = 1
tp1 tp1
end type

on t1.create
this.tp1=create tp1
this.Control[]={this.tp1}
end on

on t1.destroy
destroy(this.tp1)
end on

type tp1 from userobject within t1
event create ( )
event destroy ( )
integer x = 18
integer y = 112
integer width = 3511
integer height = 1144
long backcolor = 67108864
string text = "Detalle RIPS"
long tabtextcolor = 33554432
string picturename = "rips.ico"
long picturemaskcolor = 536870912
dw_ria dw_ria
cbx_replica cbx_replica
st_10 st_10
st_2 st_2
st_3 st_3
st_4 st_4
st_5 st_5
st_6 st_6
pb_buscar pb_buscar
st_cuantos st_cuantos
st_11 st_11
stt_diag stt_diag
pb_ayuda pb_ayuda
pb_guardar pb_guardar
pb_trae pb_trae
drop_tipo drop_tipo
st_7 st_7
gb_2 gb_2
st_tdoc st_tdoc
st_docu st_docu
st_paciente st_paciente
st_sexo st_sexo
st_edad st_edad
st_nfact st_nfact
end type

on tp1.create
this.dw_ria=create dw_ria
this.cbx_replica=create cbx_replica
this.st_10=create st_10
this.st_2=create st_2
this.st_3=create st_3
this.st_4=create st_4
this.st_5=create st_5
this.st_6=create st_6
this.pb_buscar=create pb_buscar
this.st_cuantos=create st_cuantos
this.st_11=create st_11
this.stt_diag=create stt_diag
this.pb_ayuda=create pb_ayuda
this.pb_guardar=create pb_guardar
this.pb_trae=create pb_trae
this.drop_tipo=create drop_tipo
this.st_7=create st_7
this.gb_2=create gb_2
this.st_tdoc=create st_tdoc
this.st_docu=create st_docu
this.st_paciente=create st_paciente
this.st_sexo=create st_sexo
this.st_edad=create st_edad
this.st_nfact=create st_nfact
this.Control[]={this.dw_ria,&
this.cbx_replica,&
this.st_10,&
this.st_2,&
this.st_3,&
this.st_4,&
this.st_5,&
this.st_6,&
this.pb_buscar,&
this.st_cuantos,&
this.st_11,&
this.stt_diag,&
this.pb_ayuda,&
this.pb_guardar,&
this.pb_trae,&
this.drop_tipo,&
this.st_7,&
this.gb_2,&
this.st_tdoc,&
this.st_docu,&
this.st_paciente,&
this.st_sexo,&
this.st_edad,&
this.st_nfact}
end on

on tp1.destroy
destroy(this.dw_ria)
destroy(this.cbx_replica)
destroy(this.st_10)
destroy(this.st_2)
destroy(this.st_3)
destroy(this.st_4)
destroy(this.st_5)
destroy(this.st_6)
destroy(this.pb_buscar)
destroy(this.st_cuantos)
destroy(this.st_11)
destroy(this.stt_diag)
destroy(this.pb_ayuda)
destroy(this.pb_guardar)
destroy(this.pb_trae)
destroy(this.drop_tipo)
destroy(this.st_7)
destroy(this.gb_2)
destroy(this.st_tdoc)
destroy(this.st_docu)
destroy(this.st_paciente)
destroy(this.st_sexo)
destroy(this.st_edad)
destroy(this.st_nfact)
end on

type dw_ria from datawindow within tp1
event clickup pbm_dwnlbuttonup
integer x = 14
integer y = 448
integer width = 3488
integer height = 692
integer taborder = 250
string title = "none"
string dataobject = "dw_genera_rips"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event clickup;string cual
if dwo.type="text" then
	modify(string(dwo.name)+".border=6")
	cual=dwo.name
	cual=mid(cual,1,len(cual) -2)
	if anterior=cual then
		if orden="A" then
			orden="D"
		else
			orden="A"
		end if
	else
		orden="A"
	end if
	dw_ria.setsort(cual+" "+orden)
	dw_ria.sort()
	anterior=cual
end if
end event

event clicked;if dwo.type="text" then
	modify(string(dwo.name)+".border=5")
end if
end event

event constructor;settransobject(sqlca)
end event

event doubleclicked;string colu,carreta,resu,cual,temp
colu= dwo.name
cual="r_" + mid(colu,3)
if right(cual,1)='_' then cual=left(cual,len(cual)-1)
if describe(cual+".id")="!" then return
carreta="evaluate ('if ("+ cual +'="0", 1, 0 )'+"'," +string(row) +")"
resu=describe(carreta)
if resu="1" then return
if colu="s_diagprin_" or colu="s_diagrel1_" or colu="s_diagrel2_" or colu="s_diagrel3_" or colu="s_diagcompli_" then
	st_edadsexo st_es
	st_diag st_d
	st_es.sexo=getitemstring(row,"sexo")
	st_es.edad=getitemnumber(row,"dias")
	st_es.antece='0'
	openwithparm(w_busca_diag,st_es)
	st_d=message.powerobjectparm
	if not isValid(st_d) then return
	if not isNull(st_d.codrip) then
		setitem(row,left(colu,len(colu)-1),st_d.codgeral)
		setitem(row,colu,st_d.codrip)
		stt_diag.text=st_d.descripcion
	end if
end if
if colu="s_codespecialidad" then
	open (w_busca_espe)
end if
end event

event itemchanged;accepttext()
string cod,col,nulo
long colum,i,veri
st_return_diags st

setnull(nulo)
colum=getcolumn()
col=getcolumnname()
if dataobject<>"dw_genera_rips" and dataobject<>"dw_genera_rips2" then return
if colum=13 then
	select desesp into :stt_diag.text from especialidades where codesp= :data;
	if stt_diag.text="" then return 1
end if
choose case colum
	case 7
		if cbx_replica.checked then
			for i=1 to rowcount()
				if i<>row then
					if isnull(getitemstring(i,string(dwo.name))) then
						setitem(i,dwo.name,data)
					end if
				end if
			next
		end if
	case 13, 15, 17, 33, 35, 37
		if cbx_replica.checked then
			for i=1 to rowcount()
				if i<>row and not isnull(getitemstring(i,"r_"+mid(dwo.name,3))) then
					if isnull(getitemstring(i,string(dwo.name))) then
						if (this.getitemstring(row,'s_fin_consulta') >='01' and this.getitemstring(row,'s_fin_consulta') <= '08') then 
							this.setitem(row,'s_causaexterna',"15")
						else
							this.setitem(row,'s_causaexterna',nulo)
						end if 
						veri=f_valida_fin_con(this.getitemstring(i,'s_fin_consulta'),this.getitemstring(i,'s_causaexterna'),this.getitemstring(i,"sexo"),this.getitemnumber(i,"dias"),this.getitemstring(i,'s_diagprin'))
						if veri=-1 then
							this.setitem(i,dwo.name,'')
							return 1
						end if
						setitem(i,dwo.name,data)
					end if
				end if
			next
		end if
		if (this.getitemstring(row,'s_fin_consulta') >='01' and this.getitemstring(row,'s_fin_consulta') <= '08') then 
			this.setitem(row,'s_causaexterna',"15")
		else
			this.setitem(row,'s_causaexterna',nulo)
		end if 
		veri=f_valida_fin_con(this.getitemstring(row,'s_fin_consulta'),this.getitemstring(row,'s_causaexterna'),this.getitemstring(row,"sexo"),this.getitemnumber(row,"dias"),this.getitemstring(row,'s_diagprin'))
		if veri=-1 then
			this.setitem(row,colum,"")
			return 1
		end if
		
	case 62,63,64,65,66
		string este=''
		setnull(nulo)
		if data<>"" then
			st=f_check_diag(data,getitemstring(row,"sexo"),getitemnumber(row,"dias"),este,'0',this.getitemstring(row,'rips'))
			if st.descrip_diag="" then
				setitem(row,colum,"")
				setitem(row,left(col,len(col)-1),nulo)
				return 1
			end if
			stt_diag.text=st.descrip_diag
			setitem(row,left(col,len(col)-1),este)
		else
			stt_diag.text=''
			setitem(row,left(col,len(col)-1),nulo)
		end if
end choose
end event

event itemfocuschanged;accepttext()
string cod,ojo,este,col,nulo
long colum
st_return_diags st

setnull(nulo)
colum=getcolumn()
col=getcolumnname()
if dataobject="dr_rips_rn" or dataobject="dr_rips_rn_viejo" then
	choose case colum
	case 15,16
		if getitemstring(row,colum)<>"" then
			este=getitemstring(row,left(col,len(col)-1))
			st=f_check_diag(getitemstring(row,colum),getitemstring(row,"sexorn"),1,este,'0',this.getitemstring(row,'rips'))
			if st.descrip_diag="" then
				setitem(row,colum,"")
				setitem(row,left(col,len(col)-1),nulo)
				return 1
			end if
			stt_diag.text=st.descrip_diag
		else
			stt_diag.text=""
		end if
end choose
end if
if dataobject<>"dw_genera_rips" and dataobject<>"dw_genera_rips2" then return
choose case colum
	case 13
		ojo=getitemstring(row,colum)
		if ojo<>"" then
			select desesp into :stt_diag.text from especialidades where codesp= :ojo;
		end if
	case 3
		ojo=getitemstring(row,colum)
		if ojo<>"" then
			select descripcion into :stt_diag.text from proced where codproced= :ojo;
		end if
	case 10	
	case 62,63,64,65,66
		if getitemstring(row,colum)<>"" then
			este=getitemstring(row,left(col,len(col)-1))
			st=f_check_diag(getitemstring(row,colum),getitemstring(row,"sexo"),getitemnumber(row,"dias"),este,'0',this.getitemstring(row,'rips'))
			if st.descrip_diag="" then
				setitem(row,colum,"")
				setitem(row,left(col,len(col)-1),nulo)
				return 1
			end if
			stt_diag.text=st.descrip_diag
		else
			stt_diag.text=""
		end if
end choose
end event

event retrieveend;if dataobject<>"dw_genera_rips" and dataobject<>"dw_genera_rips2" then return
if update() = 1 then 
	commit;
	cuenta()
end if
end event

event retrievestart;if tab_2.tp2_1.tab_1.selectedtab=1 then return 2
end event

event rowfocuschanged;long fila
if dataobject<>"dw_genera_rips" and dataobject<>"dw_genera_rips2" then return
fila=getrow()
if fila<=0 then return
st_tdoc.text=getitemstring(fila,"tipodoc")
st_docu.text=getitemstring(fila,"documento")
st_paciente.text=getitemstring(fila,"paciente")
st_sexo.text=getitemstring(fila,"sexo")
st_edad.text=getitemstring(fila,"edad")
st_nfact.text=string(getitemnumber(fila,"s_nfactura"))
end event

event updatestart;if dataobject<>"dw_genera_rips" and dataobject<>"dw_genera_rips2" then return
long i , filas
string nv_est,estr
filas=rowcount()
for i=1 to filas
	nv_est=getitemstring(i,'estado')
	if nv_est<>"Anulado" then 
		choose case nv_est
			case "Completo"
				estr="1"
			case "Incompleto"
				estr="2"
		end choose
		setitem(i,"estria",estr)
	end if
next
end event

event itemerror;return 1
end event

type cbx_replica from checkbox within tp1
integer x = 18
integer y = 380
integer width = 535
integer height = 52
integer taborder = 220
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Replicar para Todos"
end type

type st_10 from statictext within tp1
integer x = 14
integer y = 328
integer width = 279
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Diagnóstico:"
boolean focusrectangle = false
end type

type st_2 from statictext within tp1
integer x = 704
integer y = 396
integer width = 270
integer height = 48
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Documento:"
boolean focusrectangle = false
end type

type st_3 from statictext within tp1
integer x = 1225
integer y = 392
integer width = 219
integer height = 48
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Nombre:"
boolean focusrectangle = false
end type

type st_4 from statictext within tp1
integer x = 2487
integer y = 392
integer width = 142
integer height = 48
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Sexo:"
boolean focusrectangle = false
end type

type st_5 from statictext within tp1
integer x = 2629
integer y = 392
integer width = 133
integer height = 48
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Edad:"
boolean focusrectangle = false
end type

type st_6 from statictext within tp1
integer x = 2981
integer y = 392
integer width = 343
integer height = 48
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Nro Factura:"
boolean focusrectangle = false
end type

type pb_buscar from picturebutton within tp1
event mousemove pbm_mousemove
integer x = 3346
integer y = 268
integer width = 142
integer height = 124
integer taborder = 240
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "          &u"
string picturename = "buscar2.GIF"
string disabledname = "d_buscar2.GIF"
alignment htextalign = left!
string powertiptext = "Buscar dentro de Registros [Alt+U]"
end type

event clicked;if dw_ria.rowcount()=0 then return
open(w_busca_rias)
end event

type st_cuantos from statictext within tp1
integer x = 2976
integer y = 260
integer width = 343
integer height = 68
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 15793151
alignment alignment = center!
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type st_11 from statictext within tp1
integer x = 2734
integer y = 260
integer width = 229
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Registros:"
boolean focusrectangle = false
end type

type stt_diag from statictext within tp1
integer x = 14
integer y = 260
integer width = 2587
integer height = 68
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type pb_ayuda from picturebutton within tp1
event mousemove pbm_mousemove
integer x = 704
integer y = 120
integer width = 142
integer height = 124
integer taborder = 130
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "        &y"
string picturename = "ayuda.gif"
string disabledname = "d_ayuda.gif"
alignment htextalign = left!
string powertiptext = "Ayuda sobre generación de RIPS [Alt+Y]"
end type

event clicked;showhelp("E:\AYUDA GESTIÓN CLÍNICA INTEGRADA\!SSL!\Microsoft_HTML_Help\AYUDA-GESTI-N-CL-NICA-INTEGRADA.chm",keyword!,'Recuerde')
end event

type pb_guardar from picturebutton within tp1
event mousemove pbm_mousemove
integer x = 549
integer y = 120
integer width = 142
integer height = 124
integer taborder = 120
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "             &g"
string picturename = "guardar2.GIF"
string disabledname = "d_guardar2.GIF"
alignment htextalign = left!
string powertiptext = "Guardar Datos [Alt+G]"
end type

event clicked;if dw_ria.update()=-1 then
	rollback;
else
	commit;
end if
end event

type pb_trae from picturebutton within tp1
event mousemove pbm_mousemove
integer x = 393
integer y = 120
integer width = 142
integer height = 124
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "                 &t"
string picturename = "refrescar.GIF"
string disabledname = "d_refrescar.GIF"
alignment htextalign = left!
string powertiptext = "Traer Registros [Alt+T]"
end type

event clicked;//string cual,param
//long j
//cual=drop_tipo.text
//if cual="none" then 
//	messagebox("Error","Elija el tipo de RIA a generar")
//	return
//end if
//choose case cual
//	case "Consulta"  //archivo/empresa/contrato/fechas
//		param="AC"
//		dw_ria.dataobject="dw_genera_rips"
//		if tab_2.tp2_1.tab_1.selectedtab=2 then dw_ria.dataobject+="2"
//		dw_ria.settransobject(sqlca)
//		pb_guardar.enabled=true
//	case "Procedimientos"
//		param="AP"
//		dw_ria.dataobject="dw_genera_rips"
//		if tab_2.tp2_1.tab_1.selectedtab=2  then dw_ria.dataobject+="2"	
//		dw_ria.settransobject(sqlca)
//		pb_guardar.enabled=true
//	case "Urgencias"
//		if tab_2.tp2_1.tab_1.selectedtab=1 then
//			if tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()=0 then
//				messagebox("Error","Elija la empresa y los contratos a generar diskette")
//				return
//			end if
//			dw_ria.dataobject="dr_rips_urg"
//			dw_ria.settransobject(sqlca)
//			for j= 1 to tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()
//				dw_ria.retrieve(tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"cemp"),tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"ccontrato"),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_1.text)),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_2.text)),clugar)
//			next
//			return
//		else
//			dw_ria.dataobject="dr_rips_urg_viejo"
//			dw_ria.settransobject(sqlca)
//			dw_ria.retrieve(tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemnumber(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"num_radicacion"),tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemstring(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"clugar"))
//			return
//		end if
//		pb_guardar.enabled=false
//	case "Hospitalización"
//		if tab_2.tp2_1.tab_1.selectedtab=1 then
//			if tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()=0 then
//				messagebox("Error","Elija la empresa y los contratos a generar diskette")
//				return
//			end if
//			dw_ria.dataobject="dr_rips_hosp"
//			dw_ria.settransobject(sqlca)
//			for j= 1 to tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()
//				dw_ria.retrieve(tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"cemp"),tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"ccontrato"),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_1.text)),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_2.text)),clugar)
//			next
//			return
//		else
//			dw_ria.dataobject="dr_rips_hosp_viejo"
//			dw_ria.settransobject(sqlca)
//			dw_ria.retrieve(tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemnumber(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"num_radicacion"),tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemstring(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"clugar"))
//			return
//		end if
//		pb_guardar.enabled=false
//	case "Recien Nacido"
//		if tab_2.tp2_1.tab_1.selectedtab=1 then
//			if tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()=0 then
//				messagebox("Error","Elija la empresa y los contratos a generar diskette")
//				return
//			end if
//			dw_ria.dataobject="dr_rips_rn"
//			dw_ria.settransobject(sqlca)
//			for j= 1 to tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()
//				dw_ria.retrieve(tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"cemp"),tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"ccontrato"),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_1.text)),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_2.text)),clugar)
//			next
//			return
//		else
//			dw_ria.dataobject="dr_rips_rn_viejo"
//			dw_ria.settransobject(sqlca)
//			dw_ria.retrieve(tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemnumber(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"num_radicacion"),tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemstring(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"clugar"))
//			return
//		end if
//		pb_guardar.enabled=false
//	case "Medicamentos"
//		if tab_2.tp2_1.tab_1.selectedtab=1 then
//			if tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()=0 then
//				messagebox("Error","Elija la empresa y los contratos a generar diskette")
//				return
//			end if
//			dw_ria.dataobject="dr_rips_medica"
//			dw_ria.settransobject(sqlca)
//			for j= 1 to tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()
//				dw_ria.retrieve(tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"cemp"),tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"ccontrato"),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_1.text)),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_2.text)),clugar)
//			next
//			return
//		else
//			dw_ria.dataobject="dr_rips_medica_viejo"
//			dw_ria.settransobject(sqlca)
//			dw_ria.retrieve(tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemnumber(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"num_radicacion"),tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemstring(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"clugar"))
//			return
//		end if
//		pb_guardar.enabled=false
//	case "Otros Servicios"
//		if tab_2.tp2_1.tab_1.selectedtab=1 then
//			if tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()=0 then
//				messagebox("Error","Elija la empresa y los contratos a generar diskette")
//				return
//			end if
//			dw_ria.dataobject="dr_rips_otros"
//			dw_ria.settransobject(sqlca)
//			for j= 1 to tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()
//				dw_ria.retrieve(tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"cemp"),tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"ccontrato"),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_1.text)),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_2.text)),clugar)
//			next
//			return
//		else
//			dw_ria.dataobject="dr_rips_otros_viejo"
//			dw_ria.settransobject(sqlca)
//			dw_ria.retrieve(tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemnumber(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"num_radicacion"),tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemstring(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"clugar"))
//			return
//		end if
//		pb_guardar.enabled=false
//end choose
//if tab_2.tp2_1.tab_1.selectedtab=1 then
//	if tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()=0 then
//		messagebox("Error","Elija la empresa y los contratos a generar diskette")
//		return
//	end if
//	dw_ria.reset()
//	for j= 1 to tab_2.tp2_1.tab_1.tp_1.dw_contgenera.rowcount()
//		dw_ria.retrieve(param,tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"cemp"),tab_2.tp2_1.tab_1.tp_1.dw_contgenera.getitemstring(j,"ccontrato"),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_1.text)),datetime(date(tab_2.tp2_1.tab_1.tp_1.em_2.text)),clugar)
//	next
//end if
//if tab_2.tp2_1.tab_1.selectedtab=2 then
//	dw_ria.retrieve(param,tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemnumber(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"num_radicacion"),tab_2.tp2_1.tab_1.tp_p.dw_radica.getitemstring(tab_2.tp2_1.tab_1.tp_p.dw_radica.getrow(),"clugar"))
//end if
//rb_todos.checked=true
//rb_todos.triggerevent(clicked!)
//
end event

type drop_tipo from dropdownlistbox within tp1
integer x = 18
integer y = 160
integer width = 357
integer height = 624
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 16777215
string text = "none"
boolean vscrollbar = true
string item[] = {"Consulta","Procedimientos","Urgencias","Hospitalización","Recien Nacido","Medicamentos","Otros Servicios"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;pb_trae.triggerevent(clicked!)
end event

type st_7 from statictext within tp1
integer x = 23
integer y = 104
integer width = 357
integer height = 56
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Tipo de RIPS:"
boolean focusrectangle = false
end type

type gb_2 from groupbox within tp1
integer y = 56
integer width = 3520
integer height = 1100
integer taborder = 41
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Consulta / Modificación:"
end type

type st_tdoc from statictext within tp1
integer x = 699
integer y = 336
integer width = 119
integer height = 68
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type st_docu from statictext within tp1
integer x = 841
integer y = 336
integer width = 343
integer height = 68
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type st_paciente from statictext within tp1
integer x = 1216
integer y = 336
integer width = 1248
integer height = 68
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type st_sexo from statictext within tp1
integer x = 2487
integer y = 336
integer width = 110
integer height = 68
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
alignment alignment = center!
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type st_edad from statictext within tp1
integer x = 2619
integer y = 336
integer width = 343
integer height = 68
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
alignment alignment = center!
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type st_nfact from statictext within tp1
integer x = 2976
integer y = 336
integer width = 343
integer height = 68
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
alignment alignment = center!
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type tab_1 from tab within tp2_1
event create ( )
event destroy ( )
integer x = 14
integer y = 88
integer width = 3525
integer height = 464
integer taborder = 70
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 67108864
boolean fixedwidth = true
boolean raggedright = true
boolean focusonbuttondown = true
boolean powertips = true
boolean pictureonright = true
tabposition tabposition = tabsonleft!
integer selectedtab = 1
tp_1 tp_1
tp_p tp_p
end type

on tab_1.create
this.tp_1=create tp_1
this.tp_p=create tp_p
this.Control[]={this.tp_1,&
this.tp_p}
end on

on tab_1.destroy
destroy(this.tp_1)
destroy(this.tp_p)
end on

event selectionchanged;//If newindex=2 then
//	rb_10.enabled=false
//	dw_tipin.enabled=false
//else
//	rb_10.enabled=true
//dw_tipin.enabled=true
//end if
end event

type tp_1 from userobject within tab_1
event create ( )
event destroy ( )
integer x = 128
integer y = 16
integer width = 3378
integer height = 432
long backcolor = 67108864
long tabtextcolor = 33554432
string picturename = "guardar.ico"
long picturemaskcolor = 536870912
string powertiptext = "Generar Radicaciones de una Sola Empresa"
em_anyo em_anyo
trimestre trimestre
pb_2 pb_2
pb_1 pb_1
dw_empresa dw_empresa
pb_3 pb_3
st_1 st_1
dw_radica_rips dw_radica_rips
cbx_activos cbx_activos
end type

on tp_1.create
this.em_anyo=create em_anyo
this.trimestre=create trimestre
this.pb_2=create pb_2
this.pb_1=create pb_1
this.dw_empresa=create dw_empresa
this.pb_3=create pb_3
this.st_1=create st_1
this.dw_radica_rips=create dw_radica_rips
this.cbx_activos=create cbx_activos
this.Control[]={this.em_anyo,&
this.trimestre,&
this.pb_2,&
this.pb_1,&
this.dw_empresa,&
this.pb_3,&
this.st_1,&
this.dw_radica_rips,&
this.cbx_activos}
end on

on tp_1.destroy
destroy(this.em_anyo)
destroy(this.trimestre)
destroy(this.pb_2)
destroy(this.pb_1)
destroy(this.dw_empresa)
destroy(this.pb_3)
destroy(this.st_1)
destroy(this.dw_radica_rips)
destroy(this.cbx_activos)
end on

type em_anyo from editmask within tp_1
integer x = 18
integer y = 308
integer width = 247
integer height = 92
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 16777215
string text = "none"
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = datemask!
string mask = "yyyy"
boolean autoskip = true
boolean spin = true
string minmax = "2011~~2025"
end type

type trimestre from dropdownlistbox within tp_1
integer x = 288
integer y = 308
integer width = 544
integer height = 272
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 16777215
boolean sorted = false
boolean vscrollbar = true
string item[] = {"PRIMERO","SEGUNDO","TERCERO","CUARTO"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;CHOOSE CASE index
	case 1
		ini=date('01/01/'+tab_2.tp2_1.tab_1.tp_1.em_anyo.text)
		fin=date('31/03/'+tab_2.tp2_1.tab_1.tp_1.em_anyo.text)
	case 2
		ini=date('01/04/'+tab_2.tp2_1.tab_1.tp_1.em_anyo.text)
		fin=date('30/06/'+tab_2.tp2_1.tab_1.tp_1.em_anyo.text)
	case 3
		ini=date('01/07/'+tab_2.tp2_1.tab_1.tp_1.em_anyo.text)
		fin=date('30/09/'+tab_2.tp2_1.tab_1.tp_1.em_anyo.text)
	case 4
		ini=date('01/10/'+tab_2.tp2_1.tab_1.tp_1.em_anyo.text)
		fin=date('31/12/'+tab_2.tp2_1.tab_1.tp_1.em_anyo.text)
END CHOOSE
messagebox('',string(ini))
messagebox('',string(fin))
end event

type pb_2 from picturebutton within tp_1
event mousemove pbm_mousemove
integer x = 3232
integer y = 192
integer width = 142
integer height = 124
integer taborder = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "           &b"
string picturename = "borrar_fila.GIF"
string disabledname = "d_borrar_fila.GIF"
alignment htextalign = left!
string powertiptext = "Borrar Contrato a generar [Alt+B]"
end type

event clicked;//dw_contgenera.deleterow(dw_contgenera.getrow())
end event

type pb_1 from picturebutton within tp_1
event mousemove pbm_mousemove
integer x = 869
integer y = 280
integer width = 142
integer height = 124
integer taborder = 70
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "            &c"
string picturename = "refrescar.GIF"
string disabledname = "d_refrescar.GIF"
alignment htextalign = left!
string powertiptext = "Incluir todos los Contratos [Alt+C]"
end type

event clicked;if dw_empresa.getitemstring(1,1)="" or isnull(dw_empresa.getitemstring(1,1)) then return
long j
//for j=1 to idw_contrato.rowcount()
//	if dw_contgenera.find("cemp='"+idw_contrato.getitemstring(j,3)+"' and ccontrato='"+idw_contrato.getitemstring(j,2)+"'",1,dw_contgenera.rowcount())=0 then 
//		long donde
//		donde=dw_contgenera.insertrow(0)
//		dw_contgenera.setitem(donde,'cemp',idw_contrato.getitemstring(j,'codemp'))
//		dw_contgenera.setitem(donde,'ccontrato',idw_contrato.getitemstring(j,'codcontrato'))
//		dw_contgenera.setitem(donde,'contrato',idw_contrato.getitemstring(j,'descontrato'))
//		dw_contgenera.setitem(donde,'ctipo',idw_contrato.getitemstring(j,'ctcontra'))
//	end if
//next
//
end event

type dw_empresa from datawindow within tp_1
integer x = 27
integer width = 997
integer height = 268
integer taborder = 50
boolean bringtotop = true
string title = "none"
string dataobject = "dw_empresa_contrato_pyp"
boolean border = false
boolean livescroll = true
end type

event constructor;settransobject(sqlca)
getchild("codcontrato",idw_contrato)
idw_contrato.settransobject(sqlca)
getchild('codemp',idw_emp)
idw_emp.settransobject(sqlca)
idw_emp.retrieve('%')
insertrow(1)

end event

event itemchanged;//accepttext()
//choose case getcolumn()
//	case 1
//		idw_contrato.retrieve(data)
//		cbx_activos.triggerevent(clicked!)
//		setitem(1,2,"")
//		dw_contgenera.reset()
//	case 2
//		if dw_contgenera.find("cemp='"+getitemstring(1,1)+"' and ccontrato='"+data+"'",1,dw_contgenera.rowcount())=0 then 
//			long donde
//			donde=dw_contgenera.insertrow(0)
//			dw_contgenera.setitem(donde,'cemp',getitemstring(1,'codemp'))
//			dw_contgenera.setitem(donde,'ccontrato',data)
//			dw_contgenera.setitem(donde,'contrato',idw_contrato.getitemstring(idw_contrato.getrow(),'descontrato'))
//			dw_contgenera.setitem(donde,'ctipo',idw_contrato.getitemstring(idw_contrato.getrow(),'ctcontra'))
//			dw_contgenera.setitem(donde,'soat',idw_contrato.getitemstring(idw_contrato.getrow(),'soat'))
//			dw_contgenera.setitem(donde,'catastrofe',idw_contrato.getitemstring(idw_contrato.getrow(),'catastrofe'))
//		end if			
//end choose
end event

type pb_3 from picturebutton within tp_1
event mousemove pbm_mousemove
integer x = 3232
integer y = 56
integer width = 142
integer height = 124
integer taborder = 31
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "            &k"
string picturename = "guardar.GIF"
string disabledname = "d_guardar.GIF"
alignment htextalign = left!
string powertiptext = "Generar Diskete [Alt+K]"
end type

event clicked;//if not f_hasta() then 
//	messagebox("Atención","Su periodo de validez ha caducado, comuníquese con GCI Ltda. para reactivarlo")
//	return
//end if
//////////////// ojo para que no metan goles ^
//setpointer(hourglass!)
//i_decual='emp'
//long nrad
//if dw_contgenera.rowcount()=0 then
//	messagebox("Error","Elija la empresa y los contratos a generar diskette")
//	return
//end if
//if dw_contgenera.find('forecat=1',1,dw_contgenera.rowcount())>0 and dw_contgenera.find('forecat=0',1,dw_contgenera.rowcount())>0 then
//	messagebox('Atención','No puede radicar dos contratos al tiempo si uno de ellos es de SOAT o evento catastrófico')
//	return
//end if
//long cero=0
//if not cbx_2.checked then cero=-1
//
//string por_lug='1', l_reserva='0'
//if cbx_4.checked then l_reserva='1'
//if rb_7.checked then por_lug='0'
//nrad=f_rips(true,0,'',dw_contgenera,'emp',tab_2.tp2_1.rb_4.checked,cero,por_lug,l_reserva)
//choose case nrad
//	case -1,-10
//		rollback;
//	case 0
//	case else
//		dw_empresa.setcolumn(1)
//		dw_empresa.event itemchanged(1,dw_empresa.object.codemp,dw_empresa.getitemstring(1,'codemp'))
//		messagebox("Atención",'Radicación Nro: '+string(nrad)+' generada con éxito')
//end choose
//tab_2.tp2_1.t1.tp1.barra.position=0
//tab_2.tp2_1.tab_1.tp_p.dw_radica.retrieve()
end event

type st_1 from statictext within tp_1
integer x = 1042
integer width = 754
integer height = 52
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Radicaciones a generar Diskette:"
boolean focusrectangle = false
end type

type dw_radica_rips from datawindow within tp_1
integer x = 1061
integer y = 60
integer width = 2149
integer height = 364
integer taborder = 31
boolean bringtotop = true
string title = "none"
string dataobject = "dw_radica_rips_pedt"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;settransobject(sqlca)
end event

event itemchanged;accepttext()
If getitemstring(row,'ctipo')='2' then
  setitem(row,'valor_capita',getitemnumber(row,'nusuarios')*getitemnumber(row,'upc'))
End if

end event

type cbx_activos from checkbox within tp_1
integer x = 594
integer y = 132
integer width = 430
integer height = 56
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Solo los Activos"
end type

event clicked;if checked then
	idw_emp.retrieve('1')
	if not isnull(dw_empresa.getitemstring(1,'codemp')) then
		if idw_emp.find('codemp="'+dw_empresa.getitemstring(1,'codemp')+'"',1,idw_emp.rowcount())=0 then
			dw_empresa.reset()
			dw_empresa.insertrow(1)
		end if
	end if
	idw_contrato.setfilter('estado="1"')
else
	idw_emp.retrieve('%')
	idw_contrato.setfilter('')
end if

idw_contrato.filter()
end event

type tp_p from userobject within tab_1
event create ( )
event destroy ( )
integer x = 128
integer y = 16
integer width = 3378
integer height = 432
long backcolor = 67108864
long tabtextcolor = 33554432
string picturename = "cambia_doc.ico"
long picturemaskcolor = 536870912
string powertiptext = "Volver a generar diskettes de Radicaciones Pasadas"
st_20 st_20
st_19 st_19
dw_det dw_det
dw_radica dw_radica
pb_radvi pb_radvi
pb_anula pb_anula
end type

on tp_p.create
this.st_20=create st_20
this.st_19=create st_19
this.dw_det=create dw_det
this.dw_radica=create dw_radica
this.pb_radvi=create pb_radvi
this.pb_anula=create pb_anula
this.Control[]={this.st_20,&
this.st_19,&
this.dw_det,&
this.dw_radica,&
this.pb_radvi,&
this.pb_anula}
end on

on tp_p.destroy
destroy(this.st_20)
destroy(this.st_19)
destroy(this.dw_det)
destroy(this.dw_radica)
destroy(this.pb_radvi)
destroy(this.pb_anula)
end on

type st_20 from statictext within tp_p
integer x = 1486
integer width = 530
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Detalle de la radicación:"
boolean focusrectangle = false
end type

type st_19 from statictext within tp_p
integer x = 18
integer width = 553
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Radicaciones Anteriores:"
boolean focusrectangle = false
end type

type dw_det from datawindow within tp_p
integer x = 1481
integer y = 56
integer width = 1701
integer height = 372
integer taborder = 41
string title = "none"
string dataobject = "dw_contratos_pa_rias"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event itemchanged;if dwo.name='valor_capita' then
	if messagebox("Atención",'Está seguro que desea cambiar el monto de lo radicado.?',question!,yesno!,2)=2 then 
		settext(string(getitemnumber(getrow(),'valor_capita')))
		return 1
	end if	
	accepttext()
	dw_radica.setitem(dw_radica.getrow(),'valor_capita',getitemnumber(1,'t_capita'))
	if dw_radica.update(true,false)=-1 then
		rollback;
		return 1
	end if
	if update(true,false)=-1 then
		rollback;
	else
		commit;
		resetupdate()
		dw_radica.resetupdate()
	end if
end if
end event

type dw_radica from datawindow within tp_p
integer x = 9
integer y = 56
integer width = 1445
integer height = 372
integer taborder = 90
boolean bringtotop = true
string title = "none"
string dataobject = "dw_radica_rips"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;settransobject(sqlca)
tab_2.tp2_1.tab_1.tp_p.dw_det.settransobject(sqlca)
retrieve()
end event

event rowfocuschanged;//if getrow()<1 then return
//tab_2.tp2_1.tab_1.tp_p.dw_det.retrieve(getitemnumber(getrow(),'num_radicacion'),getitemstring(getrow(),'clugar'))
//tab_2.tp2_1.t1.tp2.dw_act_final.retrieve(getitemnumber(getrow(),'num_radicacion'),getitemstring(getrow(),'clugar'))
end event

event rbuttondown;st_dw_xa_funciones st_dw
st_dw.dw=this
st_dw.dwo=dwo
st_dw.row=row
st_dw.color_fondo=string(rgb(255,255,255))
openwithparm(w_funcion_dw,st_dw)
end event

type pb_radvi from picturebutton within tp_p
integer x = 3205
integer y = 52
integer width = 142
integer height = 124
integer taborder = 20
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string picturename = "guardar2.gif"
string disabledname = "d_guardar2.gif"
alignment htextalign = left!
string powertiptext = "Generar Diskettes de Radicaciones Pasadas"
end type

event clicked;if not f_hasta() then 
	messagebox("Atención","Su periodo de validez ha caducado, comuníquese con GCI Ltda. para reactivarlo")
	return
end if
////////////// ojo para que no metan goles ^
if dw_det.find('forecat=1',1,dw_det.rowcount())>0 and dw_det.find('forecat=0',1,dw_det.rowcount())>0 then
	messagebox('Atención','No puede generar dos contratos al tiempo con formato FORECAT si uno de ellos no es de SOAT o evento catastrófico')
	return
end if
setpointer(hourglass!)
i_decual='emp'
long nrad
if dw_radica.rowcount()>0 then
	if not isnull(dw_radica.getitemstring(dw_radica.getrow(),"estado")) then
		Messagebox("Atención","Este número de radicación está anulado.~r~nNo hay registros para generar")
	else
		nrad=f_rips(true,dw_radica.getitemnumber(dw_radica.getrow(),"num_radicacion"),dw_radica.getitemstring(dw_radica.getrow(),"clugar"),dw_det,'emp',true,-1,dw_radica.getitemstring(dw_radica.getrow(),"por_lugar"),dw_radica.getitemstring(dw_radica.getrow(),"reserva"))
		choose case nrad
			case -1,-10
				rollback;
			case 0
			case else
				messagebox("Atención",'Archivos generados con éxito')
		end choose
//		tab_2.tp2_1.t1.tp1.barra.position=0
	end if
end if
end event

type pb_anula from picturebutton within tp_p
event mousemove pbm_mousemove
integer x = 3205
integer y = 176
integer width = 142
integer height = 124
integer taborder = 30
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "        "
string picturename = "borrador.GIF"
string disabledname = "d_borrador.GIF"
alignment htextalign = left!
string powertiptext = "Anular radicación"
end type

event clicked;if tag='1' then
	if f_permiso_boton(this,'RA')=0 then return
end if
if isnull(dw_radica.getitemstring(dw_radica.getrow(),"estado")) then open(w_anula_radica)
end event

type rb_defecto from radiobutton within tp2_1
integer x = 1637
integer y = 16
integer width = 416
integer height = 64
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Por defecto en:"
end type

event clicked;sle_dir.enabled=true
cb_dir.enabled=true
end event

type sle_dir from singlelineedit within tp2_1
integer x = 2057
integer y = 4
integer width = 1367
integer height = 76
integer taborder = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
boolean displayonly = true
borderstyle borderstyle = stylelowered!
end type

event constructor;text=GetCurrentDirectory ( )
end event

type cb_dir from commandbutton within tp2_1
integer x = 3442
integer y = 8
integer width = 82
integer height = 72
integer taborder = 90
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "..."
end type

event clicked;GetFolder ( 'Directorio a Colocar RIPS', sle_dir.text )

end event

type tp2_2 from userobject within tab_2
integer x = 18
integer y = 112
integer width = 3552
integer height = 1836
long backcolor = 67108864
string text = "Por Lotes"
long tabtextcolor = 33554432
string picturename = "guardar.ico"
long picturemaskcolor = 536870912
string powertiptext = "Generar RIPS por Grupos"
cbx_3 cbx_3
rb_6 rb_6
rb_5 rb_5
pb_lote pb_lote
st_18 st_18
st_17 st_17
sle_log sle_log
st_16 st_16
cb_1 cb_1
st_15 st_15
sle_sale sle_sale
rb_tod rb_tod
rb_activ rb_activ
st_14 st_14
dw_cont dw_cont
st_13 st_13
dw_emp dw_emp
st_12 st_12
em_4 em_4
em_3 em_3
gb_7 gb_7
gb_9 gb_9
end type

on tp2_2.create
this.cbx_3=create cbx_3
this.rb_6=create rb_6
this.rb_5=create rb_5
this.pb_lote=create pb_lote
this.st_18=create st_18
this.st_17=create st_17
this.sle_log=create sle_log
this.st_16=create st_16
this.cb_1=create cb_1
this.st_15=create st_15
this.sle_sale=create sle_sale
this.rb_tod=create rb_tod
this.rb_activ=create rb_activ
this.st_14=create st_14
this.dw_cont=create dw_cont
this.st_13=create st_13
this.dw_emp=create dw_emp
this.st_12=create st_12
this.em_4=create em_4
this.em_3=create em_3
this.gb_7=create gb_7
this.gb_9=create gb_9
this.Control[]={this.cbx_3,&
this.rb_6,&
this.rb_5,&
this.pb_lote,&
this.st_18,&
this.st_17,&
this.sle_log,&
this.st_16,&
this.cb_1,&
this.st_15,&
this.sle_sale,&
this.rb_tod,&
this.rb_activ,&
this.st_14,&
this.dw_cont,&
this.st_13,&
this.dw_emp,&
this.st_12,&
this.em_4,&
this.em_3,&
this.gb_7,&
this.gb_9}
end on

on tp2_2.destroy
destroy(this.cbx_3)
destroy(this.rb_6)
destroy(this.rb_5)
destroy(this.pb_lote)
destroy(this.st_18)
destroy(this.st_17)
destroy(this.sle_log)
destroy(this.st_16)
destroy(this.cb_1)
destroy(this.st_15)
destroy(this.sle_sale)
destroy(this.rb_tod)
destroy(this.rb_activ)
destroy(this.st_14)
destroy(this.dw_cont)
destroy(this.st_13)
destroy(this.dw_emp)
destroy(this.st_12)
destroy(this.em_4)
destroy(this.em_3)
destroy(this.gb_7)
destroy(this.gb_9)
end on

type cbx_3 from checkbox within tp2_2
integer x = 878
integer y = 264
integer width = 599
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Incluir facturas en cero"
end type

type rb_6 from radiobutton within tp2_2
integer x = 910
integer y = 176
integer width = 343
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "CUPS"
end type

type rb_5 from radiobutton within tp2_2
integer x = 910
integer y = 104
integer width = 430
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Manual tarifario"
boolean checked = true
end type

type pb_lote from picturebutton within tp2_2
integer x = 1952
integer y = 1436
integer width = 146
integer height = 128
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean originalsize = true
string picturename = "guardar2.gif"
alignment htextalign = left!
string powertiptext = "Generar RIPS de Empresas seleccionadas"
end type

event clicked;//if not f_hasta() then 
//	messagebox("Atención","Su periodo de validez ha caducado, comuníquese con GCI Ltda. para reactivarlo")
//	return
//end if
//////////////// ojo para que no metan goles ^
//if dw_emp.rowcount()=0 then return
//i_decual='lote'
//if dw_emp.getitemnumber(1,'t_emp')=0 then
//	messagebox("Atencíon",'Elija contratos a radicar')
//	return
//end if
//long j,k,arc,l,nrad,cuantas_rad=0,copia
//string archivo,dir_sale,log_txt
//i_numarc=-1
//dir_sale=sle_sale.text+'\'
//archivo =dir_sale+sle_log.text
//i_numarc = fileopen(archivo,LineMode!,write!)
//if i_numarc=-1 then
//	messagebox("Atención",'No se puede crear el archivo de log')
//	return
//end if
//filewrite(i_numarc,String(Today(), "d/mm/yyyy hh:mm:ss"))
//setpointer(hourglass!)
//string por_lug='1',por_ser='1'
//if rb_7.checked then por_lug='0'
//if rb_9.checked then por_ser='%'
//for j=1 to dw_emp.rowcount()
//	if dw_emp.getitemnumber(j,'todos')<>0 then
//		log_txt='~r~nEmpresa: '+dw_emp.getitemstring(j,'desemp')+'-'+dw_emp.getitemstring(j,'codemp')
//		if filewrite(i_numarc,log_txt)>0 then
//			dw_emp.scrolltorow(j)
//			k=1
//			arc=1
//			sle_sale.text=dir_sale+left(dw_emp.getitemstring(j,'desemp'),26)+'-'+dw_emp.getitemstring(j,'codemp')
//			if CreateDirectory(sle_sale.text)=1 then
//				log_txt='~tCrear Directorio: '+sle_sale.text+'(OK)'
//				filewrite(i_numarc,log_txt)
//				do while k<= dw_emp.getitemnumber(j,'nro_arc')
//					if dw_cont.find('arch='+string(arc),1,dw_cont.rowcount())<>0 then
//						if CreateDirectory(dir_sale+left(dw_emp.getitemstring(j,'desemp'),26)+'-'+dw_emp.getitemstring(j,'codemp')+'\'+string(arc))=1 then
//							sle_sale.text=dir_sale+left(dw_emp.getitemstring(j,'desemp'),26)+'-'+dw_emp.getitemstring(j,'codemp')+'\'+string(arc)
//							log_txt='~t~tArchivo '+string(arc)+' :Crear Directorio: '+sle_sale.text+'(OK)'
//							filewrite(i_numarc,log_txt)
//							dw_cont.setfilter('codemp="'+dw_emp.getitemstring(j,'codemp')+'" and arch='+string(arc))
//							dw_cont.filter()
//							log_txt='~t~t~t'+string(dw_cont.rowcount())+' Contrato(s)~r~n'
//							for l=1 to dw_cont.rowcount()
//								log_txt+='~t~t~t'+string(dw_cont.getitemstring(l,'descontrato'))+'~r~n'
//							next
//							filewrite(i_numarc,log_txt)
//							dw_det_lote.reset()
//							for copia=1 to dw_cont.rowcount()
//								dw_det_lote.insertrow(copia)
//								dw_det_lote.setitem(copia,'cemp',dw_cont.getitemstring(copia,'codemp'))
//								dw_det_lote.setitem(copia,'ccontrato',dw_cont.getitemstring(copia,'codcontrato'))
//								dw_det_lote.setitem(copia,'valor_capita',dw_cont.getitemnumber(copia,'v_capita'))
//								dw_det_lote.setitem(copia,'ctipo',dw_cont.getitemstring(copia,'ctcontra'))
//							next
//							
//							if cbx_3.checked then
//								nrad=f_rips(true,0,'',dw_det_lote,'lote',rb_6.checked,-1,por_lug,'0')
//							else
//								nrad=f_rips(true,0,'',dw_det_lote,'lote',rb_6.checked,0,por_lug,'0')
//							end if
//							dw_cont.setfilter('codemp="'+dw_emp.getitemstring(j,'codemp')+'"')
//							dw_cont.filter()
//							choose case nrad
//								case -10
//									rollback;
//									messagebox("Error de Base de Datos",'No se puede seguir generando los archivos.Revise el log para conocer los detalles')
//									return
//								case -1
//									rollback;
//								case 0 
//								case else
//									if nrad>0 then cuantas_rad++
//							end choose
//							tab_2.tp2_1.tab_1.tp_p.dw_radica.retrieve()
//							k++
//						else //error creando subdirectorio de archivo
//							log_txt='Error creando SubDirectorio: '+sle_sale.text+'\'+string(arc)
//							filewrite(i_numarc,log_txt)
//						end if
//					end if
//					arc++
//				loop
//			else//error creando directorio
//				log_txt='Error creando Directorio: '+sle_sale.text
//				filewrite(i_numarc,log_txt)
//			end if
//		else //error escribiendo en el log
//			log_txt='Error escribiendo en Log:'+log_txt
//			filewrite(i_numarc,log_txt)
//		end if
//	end if
//next
//sle_sale.text=left(dir_sale, len(dir_sale) -1)
//filewrite(i_numarc,'Radicaciones generadas: '+string(cuantas_rad)+'~r~n'+String(Today(), "d/mm/yyyy hh:mm:ss")+'~r~n')
//fileclose(i_numarc)
//messagebox("Proceso terminado",'Revise el archivo de log para ver Resultados')
//
end event

type st_18 from statictext within tp2_2
integer x = 448
integer y = 184
integer width = 343
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Hasta"
boolean focusrectangle = false
end type

type st_17 from statictext within tp2_2
integer x = 18
integer y = 184
integer width = 343
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Desde:"
boolean focusrectangle = false
end type

type sle_log from singlelineedit within tp2_2
integer x = 1934
integer y = 176
integer width = 667
integer height = 88
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 16777215
borderstyle borderstyle = stylelowered!
end type

event constructor;text='Log'+string(today(),'dd-mm-yyyy')+'.txt'
end event

type st_16 from statictext within tp2_2
integer x = 1568
integer y = 192
integer width = 352
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Archivo de Log:"
boolean focusrectangle = false
end type

type cb_1 from commandbutton within tp2_2
integer x = 3442
integer y = 64
integer width = 91
integer height = 80
integer taborder = 40
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "..."
end type

event clicked;GetFolder ( 'Directorio a Colocar RIPS', sle_sale.text )
end event

type st_15 from statictext within tp2_2
integer x = 1481
integer y = 72
integer width = 443
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Directorio de salida:"
boolean focusrectangle = false
end type

type sle_sale from singlelineedit within tp2_2
integer x = 1929
integer y = 64
integer width = 1499
integer height = 80
integer taborder = 30
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean displayonly = true
borderstyle borderstyle = stylelowered!
end type

event constructor;text=GetCurrentDirectory ( )
end event

type rb_tod from radiobutton within tp2_2
integer x = 2903
integer y = 1348
integer width = 558
integer height = 56
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Todos los Contratos"
end type

event clicked;dw_emp.setredraw(false)
dw_cont.setredraw(false)
dw_emp.reset()
dw_cont.reset()
dw_cont.retrieve('%')
dw_emp.retrieve('%')
dw_emp.setredraw(true)
dw_cont.setredraw(true)
dw_emp.modify("b_1.text='Todas'")
end event

type rb_activ from radiobutton within tp2_2
integer x = 1979
integer y = 1344
integer width = 658
integer height = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Solo los Contratos Activos"
boolean checked = true
end type

event clicked;dw_emp.setredraw(false)
dw_cont.setredraw(false)
dw_emp.reset()
dw_cont.reset()
dw_cont.retrieve('1')
dw_emp.retrieve('1')
dw_emp.setredraw(true)
dw_cont.setredraw(true)
dw_emp.modify("b_1.text='Todas'")
end event

type st_14 from statictext within tp2_2
integer x = 1943
integer y = 284
integer width = 343
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Contratos"
boolean focusrectangle = false
end type

type dw_cont from datawindow within tp2_2
event pe_cambio ( )
integer x = 1934
integer y = 336
integer width = 1609
integer height = 944
integer taborder = 70
string title = "none"
string dataobject = "dw_cont_lote"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event pe_cambio();long cuantos,t_no
cuantos=getitemnumber(1,'total')
t_no=getitemnumber(1,'t_no')
if cuantos=rowcount() or t_no=0 then
	dw_emp.setitem(dw_emp.getrow(),'todos',1)
	dw_emp.setitem(dw_emp.getrow(),'nro_arc',cuantos)
	return
end if
if cuantos=0 then
	dw_emp.setitem(dw_emp.getrow(),'todos',0)
	dw_emp.setitem(dw_emp.getrow(),'nro_arc',0)
	return
end if
if cuantos<rowcount() then
	dw_emp.setitem(dw_emp.getrow(),'todos',2)
	dw_emp.setitem(dw_emp.getrow(),'nro_arc',cuantos)
end if
end event

event itemchanged;accepttext()
post event pe_cambio()
end event

event retrieveend;long j,nulo
setnull(nulo)
for j=1 to rowcount()
	setitem(j,'arch',nulo)
next
end event

type st_13 from statictext within tp2_2
integer x = 14
integer y = 284
integer width = 343
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Empresas"
boolean focusrectangle = false
end type

type dw_emp from datawindow within tp2_2
event pe_cambio ( long actual )
integer x = 9
integer y = 340
integer width = 1893
integer height = 1300
integer taborder = 60
string title = "none"
string dataobject = "dw_emp_lote"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event pe_cambio(long actual);long j,cuantos,nulo
setnull(nulo)
cuantos=dw_cont.rowcount()
choose case getcolumnName()
	case 'todos'
		choose case actual
			case 0//ninguno pasarlo a todos
				for j=1 to cuantos
					dw_cont.setitem(j,'arch',j)
				next
				setitem(getrow(),'nro_arc',cuantos)
				setitem(getrow(),'todos',1)
				settext('1')
			case 1,2//todos,algunos pasarlo a ninguno
				for j=1 to cuantos
					dw_cont.setitem(j,'arch',nulo)
				next
				setitem(getrow(),'nro_arc',0)
				setitem(getrow(),'todos',0)
				settext('0')
		end choose
end choose
accepttext()
end event

event itemchanged;post event pe_cambio(getitemnumber(getrow(),'todos'))
end event

event constructor;dw_cont.settransobject(sqlca)
dw_cont.retrieve('1')
settransobject(sqlca)
retrieve('1')
end event

event rowfocuschanged;if getrow()<1 then return
dw_cont.setfilter('codemp="'+getitemstring(getrow(),'codemp')+'"')
dw_cont.filter()
end event

event buttonclicked;long j,k,l,actual
if Describe('b_1.text')='Todas' then
	modify("b_1.text='Ning.'")
	k=1
	l=0
else
	modify("b_1.text='Todas'")
	k=0
	l=1
end if
setredraw(false)
dw_cont.setredraw(false)
setcolumn('todos')
actual=getrow()
for j=1 to rowcount()
	setitem(j,'todos',k)
	scrolltorow(j)
	event pe_cambio(l)
next
scrolltorow(actual)
setredraw(true)
dw_cont.setredraw(true)
end event

type st_12 from statictext within tp2_2
integer x = 23
integer y = 40
integer width = 640
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Rango de Fechas a Generar:"
boolean focusrectangle = false
end type

type em_4 from editmask within tp2_2
integer x = 443
integer y = 104
integer width = 375
integer height = 80
integer taborder = 20
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 16777215
string text = "none"
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = datemask!
string mask = "dd/mm/yyyy"
boolean autoskip = true
boolean spin = true
double increment = 1
string minmax = "2000-01-01~~2010-12-31"
end type

event constructor;if isdate("31/"+string(today(),"mm/yyyy")) then
	this.text="31/"+string(today(),"mm/yyyy")
else
	if isdate("30/"+string(today(),"mm/yyyy")) then
		this.text="30/"+string(today(),"mm/yyyy")
	else
		if isdate("29/"+string(today(),"mm/yyyy")) then
			this.text="29/"+string(today(),"mm/yyyy")
		else
			this.text="28/"+string(today(),"mm/yyyy")
		end if
	end if
end if

end event

type em_3 from editmask within tp2_2
integer x = 9
integer y = 104
integer width = 375
integer height = 80
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 16777215
string text = "none"
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = datemask!
string mask = "dd/mm/yyyy"
boolean autoskip = true
boolean spin = true
double increment = 1
string minmax = "2000-01-01~~2010-12-31"
end type

event constructor;this.text="01/"+string(today(),"mm/yyyy")
end event

type gb_7 from groupbox within tp2_2
integer x = 1943
integer y = 1284
integer width = 1595
integer height = 132
integer taborder = 90
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Mostrar:"
end type

type gb_9 from groupbox within tp2_2
integer x = 878
integer y = 40
integer width = 599
integer height = 220
integer taborder = 21
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Codificación:"
end type

